var VORLON;!function(n){!function(n){n[n.BeginDialog=0]="BeginDialog",n[n.FinalState=1]="FinalState",n[n.EndDialog=2]="EndDialog",n[n.EndDialogWithResult=3]="EndDialogWithResult",n[n.EndConversation=4]="EndConversation"}(n.EventType||(n.EventType={}));var t=(n.EventType,function(){function n(){this.dialogDataList=[],this.userEntries=[]}return n}());n.BotInfo=t;var i=function(){function n(){}return n}();n.DialogData=i;var o=function(){function n(){this.dialogStacks=[]}return n}();n.UserEntry=o;var a=function(){function n(){}return n}();n.BotDialogSessionInfo=a}(VORLON||(VORLON={}));
var __extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)},VORLON;!function(e){var t=function(t){function a(){t.call(this,"botFrameworkInspector","control.html","control.css"),this._ready=!1,this._id="BOTFRAMEWORKINSPECTOR"}return __extends(a,t),a.prototype.startDashboardSide=function(e){var t=this;void 0===e&&(e=null),this._insertHtmlContentAsync(e,function(){t._dialogsContainer=document.getElementById("dialogs"),t._dialogStacksContainer=document.getElementById("dialogstacks");var e=function(){t._ready||"none"!==t._divPluginBot.style.display?(t._ready=!0,t.display()):window.setTimeout(e,500)};t._loadScript("/vorlon/plugins/botFrameworkInspector/cytoscape.min.js",function(){t._loadScript("/vorlon/plugins/botFrameworkInspector/dagre.min.js",function(){t._loadScript("/vorlon/plugins/botFrameworkInspector/cytoscape-dagre.js",function(){t._divPluginBot=document.getElementsByClassName("plugin-botframeworkinspector")[0],window.setTimeout(e,500)})})}),t._datacheckbox=document.getElementById("showdatacheckbox"),t._datacheckbox.addEventListener("click",function(){var e="data",a="data-hidden";t._datacheckbox.checked&&(e="data-hidden",a="data");for(var n=document.getElementsByClassName(e);n.length;)n[0].className=a})})},a.prototype._drawGraphNodes=function(e,t){var a=cytoscape({container:document.getElementById("right"),boxSelectionEnabled:!1,autounselectify:!0,wheelSensitivity:.2,layout:{name:"dagre"},style:[{selector:"node",style:{content:"data(value)","text-opacity":.5,"text-valign":"center","text-halign":"right","background-color":"#11479e"}},{selector:"edge",style:{width:2,"target-arrow-shape":"triangle","line-color":"#9dbaea","target-arrow-color":"#9dbaea","curve-style":"bezier"}},{selector:"node.currentState",style:{"background-color":"#86B342"}}],elements:{nodes:e,edges:t}});a.on("tap","node",function(e){var t=e.cyTarget;console.log(t.id())})},a.prototype._loadScript=function(e,t){var a=document.createElement("script");a.type="text/javascript",a.onload=function(){t()},a.src=vorlonBaseURL+e,document.getElementsByTagName("head")[0].appendChild(a)},a.prototype.onRealtimeMessageReceivedFromClientSide=function(e){this._lastReceivedBotInfo=e,this.display()},a.prototype.display=function(){var t=this,a=[],n=[],i=[];this._lastReceivedBotInfo&&(this._dialogsContainer.innerHTML=null,this._lastReceivedBotInfo.dialogDataList.forEach(function(e){var a=document.createElement("div");a.classList.add("dialog");var n=document.createElement("p");n.innerText=e.library+" > "+e.id,n.classList.add("dialog-id"),a.appendChild(n);var i=document.createElement("div");i.classList.add("dialog-detail"),a.appendChild(i);var o=document.createElement("p");o.innerText="Steps ",i.appendChild(o);var d=document.createElement("div");if(d.classList.add("waterfall-steps"),i.appendChild(d),e.dialog&&e.dialog.length)if(e.dialog.length>0)for(var s=0;s<e.dialog.length;s++){var r=document.createElement("div");r.classList.add("waterfall-step"),r.innerText=(s+1).toString(),r.title=e.dialog[s],d.appendChild(r)}else o.innerText+=" none.";else o.innerText+=" none.";t._dialogsContainer.appendChild(a)}),this._lastReceivedBotInfo.userEntries&&this._lastReceivedBotInfo.userEntries.length&&(this._dialogStacksContainer.innerHTML=null,this._lastReceivedBotInfo.userEntries.forEach(function(o){var d=document.createElement("div");d.classList.add("user-entry");var s=document.createElement("p");s.classList.add("entry"),s.innerHTML="<strong>User entry:</strong> "+o.message.text,d.appendChild(s);var r=document.createElement("div");r.classList.add("stacks"),d.appendChild(r),o.dialogStacks.forEach(function(o){var d=document.createElement("div");d.classList.add("stack"),r.appendChild(d);var s=document.createElement("div");if(s.classList.add("dialogs-in-stack"),d.appendChild(s),o.sessionState.callstack&&o.sessionState.callstack.length>0){var l;o.sessionState.callstack.forEach(function(e){var t=document.createElement("div");t.classList.add("dialog-in-stack"),t.innerText=e.id,void 0!=e.state["BotBuilder.Data.WaterfallStep"]&&(t.innerText+="("+(e.state["BotBuilder.Data.WaterfallStep"]+1)+")"),s.appendChild(t),l=document.createElement("div"),l.classList.add("line"),s.appendChild(l)})}else s.innerText="(No dialog in stack)",l=document.createElement("div"),l.classList.add("line"),s.appendChild(l);var c=document.createElement("p");if(c.innerText="["+e.EventType[o.eventType],o.impactedDialogId){if(c.innerText+="("+o.impactedDialogId+")]",o.eventType===e.EventType.BeginDialog){o.sessionState.callstack&&0!=o.sessionState.callstack.length||(i=[]);var p={data:{id:a.length,value:o.impactedDialogId}};if(a.push(p),i.push(p),i.length>1){var g=i.length-1,u={data:{source:i[g-1].data.id,target:i[g].data.id}};n.push(u)}}}else c.innerText+="]";if((o.eventType===e.EventType.EndDialog||o.eventType===e.EventType.EndDialogWithResult)&&i.length>1){var g=i.length-1,u={data:{source:i[g].data.id,target:i[g-1].data.id}};n.push(u),i.pop()}o.eventType===e.EventType.EndConversation&&i.length>1&&(i=[]),s.appendChild(c);var h=document.createElement("div");h.classList.add(t._datacheckbox.checked?"data":"data-hidden"),h.innerHTML="<p><strong>ConversationData:</strong> "+JSON.stringify(o.conversationData)+"</p>",h.innerHTML+="<p><strong>DialogData:</strong> "+JSON.stringify(o.dialogData)+"</p>",h.innerHTML+="<p><strong>PrivateConversationData:</strong> "+JSON.stringify(o.privateConversationData)+"</p>",h.innerHTML+="<p><strong>UserData:</strong> "+JSON.stringify(o.userData)+"</p>",d.appendChild(h)}),t._dialogStacksContainer.appendChild(d)}),a[a.length-1].classes="currentState",this._drawGraphNodes(a,n)))},a}(e.DashboardPlugin);e.BotFrameworkInspectorDashboard=t,e.Core.RegisterDashboardPlugin(new t)}(VORLON||(VORLON={}));