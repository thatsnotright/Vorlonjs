var VORLON;!function(n){!function(n){n[n.BeginDialog=0]="BeginDialog",n[n.FinalState=1]="FinalState",n[n.EndDialog=2]="EndDialog",n[n.EndDialogWithResult=3]="EndDialogWithResult",n[n.EndConversation=4]="EndConversation"}(n.EventType||(n.EventType={}));var t=(n.EventType,function(){function n(){this.dialogDataList=[],this.userEntries=[]}return n}());n.BotInfo=t;var i=function(){function n(){}return n}();n.DialogData=i;var o=function(){function n(){this.dialogStacks=[]}return n}();n.UserEntry=o;var a=function(){function n(){}return n}();n.BotDialogSessionInfo=a}(VORLON||(VORLON={}));
var __extends=this&&this.__extends||function(t,o){function e(){this.constructor=t}for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n]);t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)},VORLON;!function(t){var o=function(o){function e(){o.call(this,"botFrameworkInspector"),t.Tools.IsWindowAvailable||(this.path=require("path"),this.requireHook=require("require-hook"),this._ready=!0,this._hooked=!1,this._botInfo=new t.BotInfo)}return __extends(e,o),e.prototype.startClientSide=function(){t.Tools.IsWindowAvailable||(this.requireHook.attach(this.path.resolve()),this.hookBotFrameworkFunctions())},e.prototype.clone=function(t){return JSON.parse(JSON.stringify(t||{}))},e.prototype.addDialogStack=function(o,e,n){void 0===n&&(n=void 0);var i=new t.BotDialogSessionInfo;i.sessionState=this.clone(o.sessionState),i.conversationData=this.clone(o.conversationData),i.dialogData=this.clone(o.dialogData),i.privateConversationData=this.clone(o.privateConversationData),i.userData=this.clone(o.userData),i.eventType=e,i.impactedDialogId=n;var r=!1;if(this._botInfo.userEntries.forEach(function(t){t.message.address.id===o.message.address.id&&(t.dialogStacks.push(i),r=!0)}),!r){var a=new t.UserEntry;a.message=o.message,a.dialogStacks.push(i),this._botInfo.userEntries.push(a)}this.refresh()},e.prototype.hookBotFrameworkFunctions=function(){var o=this;this.requireHook.setEvent(function(e,n){if(!o._hooked&&"botbuilder"===n.require){var i=e.Session.prototype.sendBatch;e.Session.prototype.sendBatch=function(){var e=i.apply(this,arguments),n=this.options.onSave,r=this;return this.options.onSave(function(){var e=n.apply(this,arguments);return o.addDialogStack(r,t.EventType.FinalState),e}),e};var r=e.Session.prototype.beginDialog;e.Session.prototype.beginDialog=function(e){return o.addDialogStack(this,t.EventType.BeginDialog,e),r.apply(this,arguments)};var a=e.Session.prototype.endDialog;e.Session.prototype.endDialog=function(){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return o.addDialogStack(this,t.EventType.EndDialog),a.apply(this,arguments)};var s=e.Session.prototype.endDialogWithResult;e.Session.prototype.endDialogWithResult=function(){return o.addDialogStack(this,t.EventType.EndDialogWithResult),s.apply(this,arguments)};var p=e.Session.prototype.endConversation;e.Session.prototype.endConversation=function(){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return o.addDialogStack(this,t.EventType.EndConversation),p.apply(this,arguments)};var u=e.Library.prototype.dialog;e.Library.prototype.dialog=function(e,n){if(n){var i=new t.DialogData;i.id=e,i.dialog=n instanceof Array?n.map(function(t){return t.toString()}):[n.toString()],i.library=this.name,o._botInfo.dialogDataList.push(i),o.refresh()}return u.apply(this,arguments)},o._hooked=!0}return e})},e.prototype.getID=function(){return"BOTFRAMEWORKINSPECTOR"},e.prototype.refresh=function(){this.sendToDashboard(this._botInfo)},e}(t.ClientPlugin);t.BotFrameworkInspectorClient=o,t.Core.RegisterClientPlugin(new o)}(VORLON||(VORLON={}));