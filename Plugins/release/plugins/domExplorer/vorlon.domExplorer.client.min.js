var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},VORLON;!function(VORLON){var DOMExplorerClient=function(_super){function DOMExplorerClient(){_super.call(this,"domExplorer"),this._internalId=0,this._globalloadactive=!1,this._id="DOM",this._ready=!0}return __extends(DOMExplorerClient,_super),DOMExplorerClient.GetAppliedStyles=function(e){for(var t,n,r=new Array,o=document.styleSheets,i=new Array,l=0;l<o.length;l++){var a=o[l].rules||o[l].cssRules;if(a)for(var s=0;s<a.length;s++){var d=a[s],h=d.selectorText;try{var p=document.querySelectorAll(h);for(n=0;n<p.length;n++){var u=p[n];if(t=d.style,u===e)for(var c=0;c<t.length;c++)-1===i.indexOf(t[c])&&i.push(t[c])}}catch(m){}}}if(t=e.style)for(n=0;n<t.length;n++)-1===i.indexOf(t[n])&&i.push(t[n]);var y=document.defaultView||window;for(n=0;n<i.length;n++){var v=i[n];y.getComputedStyle&&r.push(v+":"+y.getComputedStyle(e,"").getPropertyValue(v))}return r},DOMExplorerClient.prototype._packageNode=function(e){if(e){var t={id:e.id,type:e.nodeType,name:e.localName,classes:e.className,content:null,hasChildNodes:!1,attributes:e.attributes?Array.prototype.map.call(e.attributes,function(e){return[e.name,e.value]}):[],children:[],isEmpty:!1,rootHTML:null,internalId:VORLON.Tools.CreateGUID()};return""===e.innerHTML&&(t.isEmpty=!0),("3"==t.type||"#comment"===e.nodeName)&&("#comment"===e.nodeName&&(t.name="#comment"),t.content=e.textContent),e.__vorlon&&e.__vorlon.internalId?t.internalId=e.__vorlon.internalId:(e.__vorlon||(e.__vorlon={}),e.__vorlon.internalId=t.internalId),t}},DOMExplorerClient.prototype._packageDOM=function(e,t,n,r){if(void 0===n&&(n=!1),void 0===r&&(r=""),e.childNodes&&0!==e.childNodes.length)for(var o=0;o<e.childNodes.length;o++){var i=e.childNodes[o],l=this._packageNode(i),a=!1;if(i.childNodes&&i.childNodes.length>1||i&&i.nodeName&&("script"===i.nodeName.toLowerCase()||"style"===i.nodeName.toLowerCase())?l.hasChildNodes=!0:(n||1==i.childNodes.length)&&(this._packageDOM(i,l,n,r),a=!0),""!==r&&!a&&n&&this._packageDOM(i,l,n,r),i.__vorlon&&i.__vorlon.ignore)return;t.children.push(l),r===l.internalId&&(r="")}},DOMExplorerClient.prototype._packageAndSendDOM=function(e,t){void 0===t&&(t=""),this._internalId=0;var n=this._packageNode(e);this._packageDOM(e,n,!1,t),t&&(n.highlightElementID=t),this.sendCommandToDashboard("refreshNode",n)},DOMExplorerClient.prototype._markForRefresh=function(){this.refresh()},DOMExplorerClient.prototype.startClientSide=function(){},DOMExplorerClient.prototype._getElementByInternalId=function(e,t){if(!t)return null;if(t.__vorlon&&t.__vorlon.internalId===e)return t;if(!t.children)return null;for(var n=0;n<t.children.length;n++){var r=this._getElementByInternalId(e,t.children[n]);if(r)return r}return null},DOMExplorerClient.prototype.getInnerHTML=function(e){var t=this._getElementByInternalId(e,document.documentElement);t&&this.sendCommandToDashboard("innerHTML",{internalId:e,innerHTML:t.innerHTML})},DOMExplorerClient.prototype.getComputedStyleById=function(e){var t=this._getElementByInternalId(e,document.documentElement);if(t){var n=document.defaultView||window;if(n.getComputedStyle){var r=n.getComputedStyle(t),o=[];for(var i in r)isNaN(Number(i))&&"parentRule"!==i&&"length"!==i&&"cssText"!==i&&"function"!=typeof r[i]&&r[i]&&o.push({name:i,value:r[i]});this.sendCommandToDashboard("setComputedStyle",o)}}},DOMExplorerClient.prototype.getStyle=function(e){var t=this._getElementByInternalId(e,document.documentElement);if(t){var n=document.defaultView||window;if(n.getComputedStyle){var r=n.getComputedStyle(t),o={border:{rightWidth:r.borderRightWidth,leftWidth:r.borderLeftWidth,topWidth:r.borderTopWidth,bottomWidth:r.borderBottomWidth},margin:{bottom:r.marginBottom,left:r.marginLeft,top:r.marginTop,right:r.marginRight},padding:{bottom:r.paddingBottom,left:r.paddingLeft,top:r.paddingTop,right:r.paddingRight},size:{width:r.width,height:r.height}};this.sendCommandToDashboard("setLayoutStyle",o)}}},DOMExplorerClient.prototype.saveInnerHTML=function(e,t){var n=this._getElementByInternalId(e,document.documentElement);n&&(n.innerHTML=t),this.refreshbyId(e)},DOMExplorerClient.prototype._offsetFor=function(e){var t=e.getBoundingClientRect(),n=e.offsetWidth,r=e.offsetHeight;return{x:t.top-e.scrollTop,y:t.left-e.scrollLeft,width:n,height:r}},DOMExplorerClient.prototype.setClientHighlightedElement=function(e){var t=this._getElementByInternalId(e,document.documentElement);if(t){this._overlay||(this._overlay=document.createElement("div"),this._overlay.id="vorlonOverlay",this._overlay.style.position="fixed",this._overlay.style.backgroundColor="rgba(255,255,0,0.4)",this._overlay.style.pointerEvents="none",this._overlay.__vorlon={ignore:!0},document.body.appendChild(this._overlay)),this._overlay.style.display="block";var n=this._offsetFor(t);this._overlay.style.top=n.x+document.body.scrollTop+"px",this._overlay.style.left=n.y+document.body.scrollLeft+"px",this._overlay.style.width=n.width+"px",this._overlay.style.height=n.height+"px"}},DOMExplorerClient.prototype.unhighlightClientElement=function(){this._overlay&&(this._overlay.style.display="none")},DOMExplorerClient.prototype.onRealtimeMessageReceivedFromDashboardSide=function(){},DOMExplorerClient.prototype.refresh=function(){var e=this;if(!document.body)return setTimeout(function(){e.refresh()},200),void 0;var t=this._packageNode(document.documentElement);this._packageDOM(document.documentElement,t,this._globalloadactive,null),this.sendCommandToDashboard("init",t)},DOMExplorerClient.prototype.inspect=function(){var e=this;if(document.elementFromPoint){if(this._overlayInspect)return;this.trace("INSPECT"),this._overlayInspect=document.createElement("DIV"),this._overlayInspect.__vorlon={ignore:!0},this._overlayInspect.style.position="fixed",this._overlayInspect.style.left="0",this._overlayInspect.style.right="0",this._overlayInspect.style.top="0",this._overlayInspect.style.bottom="0",this._overlayInspect.style.zIndex="5000000000000000",this._overlayInspect.style.touchAction="manipulation",this._overlayInspect.style.backgroundColor="rgba(255,0,0,0.3)",document.body.appendChild(this._overlayInspect);var t="mousedown";void 0!==this._overlayInspect.onpointerdown&&(t="pointerdown"),this._overlayInspect.addEventListener(t,function(t){var n=t;e.trace("tracking element at "+n.clientX+"/"+n.clientY),e._overlayInspect.parentElement.removeChild(e._overlayInspect);var r=document.elementFromPoint(n.clientX,n.clientY);r?(e.trace("element found"),e.openElementInDashboard(r)):e.trace("element not found"),e._overlayInspect=null})}else this.trace("VORLON, inspection not supported")},DOMExplorerClient.prototype.openElementInDashboard=function(e){if(e){var t=this.getFirstParentWithInternalId(e);t&&this.refreshbyId(t,this._packageNode(e).internalId)}},DOMExplorerClient.prototype.setStyle=function(e,t,n){var r=this._getElementByInternalId(e,document.documentElement);r.style[t]=n},DOMExplorerClient.prototype.globalload=function(e){this._globalloadactive=e,this._globalloadactive&&this.refresh()},DOMExplorerClient.prototype.getFirstParentWithInternalId=function(e){return e?e.parentNode&&e.parentNode.__vorlon&&e.parentNode.__vorlon.internalId?e.parentNode.__vorlon.internalId:this.getFirstParentWithInternalId(e.parentNode):null},DOMExplorerClient.prototype.getMutationObeserverAvailability=function(){var e=window.MutationObserver||window.WebKitMutationObserver||null;e?this.sendCommandToDashboard("mutationObeserverAvailability",{availability:!0}):this.sendCommandToDashboard("mutationObeserverAvailability",{availability:!1})},DOMExplorerClient.prototype.searchDOMBySelector=function(e,t){void 0===t&&(t=0);var n=0;try{if(e){var r=document.querySelectorAll(e);if(n=r.length,r.length){r[t]||(t=0);var o=this.getFirstParentWithInternalId(r[t]);o&&this.refreshbyId(o,this._packageNode(r[t]).internalId),t<r.length+1&&t++}}}catch(i){}this.sendCommandToDashboard("searchDOMByResults",{length:n,selector:e,position:t})},DOMExplorerClient.prototype.setAttribute=function(internaID,attributeName,attributeOldName,attributeValue){var element=this._getElementByInternalId(internaID,document.documentElement);if("attributeName"!==attributeName){try{element.removeAttribute(attributeOldName)}catch(e){}attributeName&&element.setAttribute(attributeName,attributeValue),attributeName&&0===attributeName.indexOf("on")&&(element[attributeName]=function(){try{eval(attributeValue)}catch(e){console.error(e)}})}},DOMExplorerClient.prototype.refreshbyId=function(e,t){void 0===t&&(t=""),e&&t?this._packageAndSendDOM(this._getElementByInternalId(e,document.documentElement),t):e&&this._packageAndSendDOM(this._getElementByInternalId(e,document.documentElement))},DOMExplorerClient.prototype.setElementValue=function(e,t){var n=this._getElementByInternalId(e,document.documentElement);n.innerHTML=t},DOMExplorerClient.prototype.getNodeStyle=function(e){var t=this._getElementByInternalId(e,document.documentElement);if(t){var n=DOMExplorerClient.GetAppliedStyles(t);this.sendCommandToDashboard("nodeStyle",{internalID:e,styles:n})}},DOMExplorerClient}(VORLON.ClientPlugin);VORLON.DOMExplorerClient=DOMExplorerClient,DOMExplorerClient.prototype.ClientCommands={getMutationObeserverAvailability:function(){var e=this;e.getMutationObeserverAvailability()},style:function(e){var t=this;t.setStyle(e.order,e.property,e.newValue)},searchDOMBySelector:function(e){var t=this;t.searchDOMBySelector(e.selector,e.position)},setSettings:function(e){var t=this;e&&null!=e.globalload&&t.globalload(e.globalload)},saveinnerHTML:function(e){var t=this;t.saveInnerHTML(e.order,e.innerhtml)},attribute:function(e){var t=this;t.setAttribute(e.order,e.attributeName,e.attributeOldName,e.attributeValue)},setElementValue:function(e){var t=this;t.setElementValue(e.order,e.value)},select:function(e){var t=this;t.unhighlightClientElement(),t.setClientHighlightedElement(e.order),t.getNodeStyle(e.order)},unselect:function(e){var t=this;t.unhighlightClientElement(e.order)},highlight:function(e){var t=this;t.unhighlightClientElement(),t.setClientHighlightedElement(e.order)},unhighlight:function(e){var t=this;t.unhighlightClientElement(e.order)},refreshNode:function(e){var t=this;t.refreshbyId(e.order)},getNodeStyles:function(){console.log("get node style")},refresh:function(){var e=this;e.refresh()},inspect:function(){var e=this;e.inspect()},getInnerHTML:function(e){var t=this;t.getInnerHTML(e.order)},getStyle:function(e){var t=this;t.getStyle(e.order)},getComputedStyleById:function(e){var t=this;t.getComputedStyleById(e.order)}},VORLON.Core.RegisterClientPlugin(new DOMExplorerClient)}(VORLON||(VORLON={}));