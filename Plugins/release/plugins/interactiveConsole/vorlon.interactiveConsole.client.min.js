var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},VORLON;!function(VORLON){var InteractiveConsoleClient=function(_super){function InteractiveConsoleClient(){var e=this;_super.call(this,"interactiveConsole"),this._cache=[],this._pendingEntries=[],this._maxBatchSize=50,this._maxBatchTimeout=200,this._objPrototype=Object.getPrototypeOf({}),this._hooks={clear:null,dir:null,log:null,debug:null,error:null,warn:null,info:null},this._ready=!1,this._id="CONSOLE",this.traceLog=function(t){e._hooks&&e._hooks.log?e._hooks.log.call(console,t):console.log(t)}}return __extends(InteractiveConsoleClient,_super),InteractiveConsoleClient.prototype.inspect=function(e,t,o){if(!e||"object"!=typeof e)return null;var n=Object.getOwnPropertyNames(e),r=Object.getPrototypeOf(e),s={functions:[],properties:[]};r&&r!=this._objPrototype&&(s.proto=this.inspect(r,t,o+1));for(var i=0,a=n.length;a>i;i++){var l=n[i],c="";if("__vorlon"!==l)try{var p=t[l];c=typeof p,"function"===c?s.functions.push(l):"undefined"===c?s.properties.push({name:l,val:void 0}):"null"===c?s.properties.push({name:l,val:null}):"object"===c?o>5?s.properties.push({name:l,val:"Vorlon cannot inspect deeper, try inspecting the proper object directly"}):s.properties.push({name:l,val:this.inspect(p,p,o+1)}):s.properties.push({name:l,val:p.toString()})}catch(h){this.trace("error reading property "+l+" of type "+c),this.trace(h),s.properties.push({name:l,val:"oups, Vorlon has an error reading this "+c+" property..."})}}return s.functions=s.functions.sort(function(e,t){var o=e.toLowerCase(),n=t.toLowerCase();return o>n?1:n>o?-1:0}),s.properties=s.properties.sort(function(e,t){var o=e.name.toLowerCase(),n=t.name.toLowerCase();return o>n?1:n>o?-1:0}),s},InteractiveConsoleClient.prototype.getMessages=function(e){var t=[];if(e&&e.length>0)for(var o=0,n=e.length;n>o;o++){var r=e[o];"string"==typeof r||"number"==typeof r?t.push(r):VORLON.Tools.IsWindowAvailable?r==window||r==document?t.push("VORLON : object cannot be inspected, too big..."):t.push(this.inspect(r,r,0)):t.push(this.inspect(r,r,0))}return t},InteractiveConsoleClient.prototype.addEntry=function(e){this._cache.push(e),this._pendingEntries.push(e),this._pendingEntries.length>this._maxBatchSize?this.sendPendings():this.checkPendings()},InteractiveConsoleClient.prototype.checkPendings=function(){var e=this;this._pendingEntriesTimeout||(this._pendingEntriesTimeout=setTimeout(function(){e._pendingEntriesTimeout=null,e.sendPendings()},this._maxBatchTimeout))},InteractiveConsoleClient.prototype.sendPendings=function(){var e=this._pendingEntries;this._pendingEntries=[],this.sendCommandToDashboard("entries",{entries:e})},InteractiveConsoleClient.prototype.batchSend=function(e){this._pendingEntriesTimeout&&(clearTimeout(this._pendingEntriesTimeout),this._pendingEntriesTimeout=null);for(var t=[],o=0,n=e.length;n>o;o++)t.length<this._maxBatchSize?t.push(e[o]):(this.sendCommandToDashboard("entries",{entries:t}),t=[]);this.sendCommandToDashboard("entries",{entries:t})},InteractiveConsoleClient.prototype.startClientSide=function(){var e=this;this._cache=[],this._pendingEntries=[];var t=VORLON.Tools.IsWindowAvailable?window.console:global.console;this._hooks.clear=VORLON.Tools.Hook(t,"clear",function(){e.clearClientConsole()}),this._hooks.dir=VORLON.Tools.Hook(t,"dir",function(t){var o={messages:e.getMessages(t),type:"dir"};e.addEntry(o)}),this._hooks.log=VORLON.Tools.Hook(t,"log",function(t){var o={messages:e.getMessages(t),type:"log"};e.addEntry(o)}),this._hooks.debug=VORLON.Tools.Hook(t,"debug",function(t){var o={messages:e.getMessages(t),type:"debug"};e.addEntry(o)}),this._hooks.info=VORLON.Tools.Hook(t,"info",function(t){var o={messages:e.getMessages(t),type:"info"};e.addEntry(o)}),this._hooks.warn=VORLON.Tools.Hook(t,"warn",function(t){var o={messages:e.getMessages(t),type:"warn"};e.addEntry(o)}),this._hooks.error=VORLON.Tools.Hook(t,"error",function(t){var o={messages:e.getMessages(t),type:"error"};e.addEntry(o)});var o=Error;Error=function(t){var n=new o(t),r={messages:e.getMessages(t),type:"exception"};return e.addEntry(r),n},Error.prototype=o.prototype,VORLON.Tools.IsWindowAvailable&&window.addEventListener("error",function(t){t&&t.error&&e.addEntry({messages:[t.error.stack],type:"exception"})}),this._ready=!0},InteractiveConsoleClient.prototype.clearClientConsole=function(){this.sendCommandToDashboard("clear"),this._cache=[]},InteractiveConsoleClient.prototype.evalOrderFromDashboard=function(order){try{eval(order)}catch(e){console.error("Unable to execute order: "+e.message)}},InteractiveConsoleClient.prototype.refresh=function(){var e=this;setTimeout(function(){e.sendCommandToDashboard("clear"),e.batchSend(e._cache)},300)},InteractiveConsoleClient}(VORLON.ClientPlugin);VORLON.InteractiveConsoleClient=InteractiveConsoleClient,InteractiveConsoleClient.prototype.ClientCommands={order:function(e){var t=this;t.evalOrderFromDashboard(e.order)},clear:function(){console.clear()}},VORLON.Core.RegisterClientPlugin(new InteractiveConsoleClient)}(VORLON||(VORLON={}));