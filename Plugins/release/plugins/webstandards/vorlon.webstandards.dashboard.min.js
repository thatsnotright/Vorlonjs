var __extends=this&&this.__extends||function(e,t){function s(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)},VORLON;!function(e){var t,s={webstandards:"1. Web standards",accessibility:"2. Accessibility",performances:"3. Performances",mobileweb:"4. Mobile web"},n=function(s){function n(){s.call(this,"webstandards","control.html","control.css"),this._rulesPanel=null,this._ruleDetailPanel=null,this._id="WEBSTANDARDS",this._ready=!0}return __extends(n,s),n.prototype.startDashboardSide=function(s){var n=this;void 0===s&&(s=null),this._insertHtmlContentAsync(s,function(s){n._ruleDetailPanel=new a(n,s.querySelector("#webstandards-ruledetailpanel")),n._rulesPanel=new l(n,s.querySelector("#webstandards-rulespanel"),n._ruleDetailPanel),n._startCheckButton=s.querySelector("#startCheck"),n._cancelCheckButton=s.querySelector("#cancelCheck"),n._rootDiv=s,n._startCheckButton.addEventListener("click",function(){n._startCheckButton.disabled=!0,n._cancelCheckButton.disabled=!1,n._rootDiv.classList.add("loading"),n._rulesPanel.clear("analysis in progress..."),n._currentAnalyseId=e.Tools.CreateGUID(),n._analysePending=!0,n._analyseResult=null,n.sendCommandToClient("startNewAnalyze",{id:n._currentAnalyseId})}),n._cancelCheckButton.addEventListener("click",function(){n.sendCommandToClient("cancelAnalyze",{id:n._currentAnalyseId})}),clearInterval(t),t=setInterval(function(){n.checkLoadingState()},3e3)})},n.prototype.setAnalyseResult=function(e){this._rootDiv.classList.remove("loading"),this._ruleDetailPanel.setMessage("click on a rule in the result panel to show details"),this._rulesPanel.setRules(e),this._startCheckButton.disabled=!1,this._cancelCheckButton.disabled=!0},n.prototype.analyseCanceled=function(){this._rootDiv.classList.remove("loading"),this._startCheckButton.disabled=!1,this._cancelCheckButton.disabled=!0,this._rootDiv.classList.remove("loading"),this._rulesPanel.clear("retry by clicking on start button")},n.prototype.checkLoadingState=function(){this._analyseResult&&this._analysePending&&(this._analysePending=!1,this._rootDiv.classList.remove("loading"),this._ruleDetailPanel.setMessage("click on a rule in the result panel to show details"),this._rulesPanel.setRules(this._analyseResult),this._startCheckButton.disabled=!1,this._cancelCheckButton.disabled=!0)},n}(e.DashboardPlugin);e.WebStandardsDashboard=n,n.prototype.DashboardCommands={analyseResult:function(e){var t=this;t.setAnalyseResult(e.result)},analyseCanceled:function(e){var t=this;t.analyseCanceled(e.id)}},e.Core.RegisterDashboardPlugin(new n);var l=function(){function t(e,t,s){this.plugin=e,this.element=t,this.element.style.display="none",this.detailpanel=s}return t.prototype.clear=function(e){this.element.style.display="none",this.detailpanel.clear(e)},t.prototype.setRules=function(e){this.plugin.trace("RENDER ANALYZE"),this.plugin.trace(e),this.element.style.display="",this.element.innerHTML="",this.renderRules(e.results.rules,this.element,1)},t.prototype.renderRules=function(e,t,n){var l=this,a=[];for(var i in e){var r=e[i];if(r.skipRootLevel)for(var o=0;o<r.items.length;o++)a.push(r.items[o]);else r.title||(void 0!==r.rules&&(r.stats=this.getRuleStats(r.rules)),r.title=s[r.id]),a.push(r)}a.sort(function(e,t){return e.title.localeCompare(t.title)}),a.forEach(function(e){l.renderRule(e,t,n)})},t.prototype.renderRule=function(t,s,n){var l=this,a=new e.FluentDOM("DIV","rule level"+n,s);a.append("DIV","title",function(e){if(void 0!==t.failed&&e.createChild("SPAN","state fa "+(t.failed?"fa-close":"fa-check")),e.createChild("SPAN").text(t.title),void 0!==t.stats){var s=e.createChild("SPAN").addClass("ruleSummary-container");t.stats.isAxeRulesSet?s.createChild("SPAN").addClass("ruleSummary-failed").text("("+t.stats.failed):(s.createChild("SPAN").addClass("ruleSummary-succeed").text(t.stats.succeed),s.createChild("SPAN").addClass("ruleSummary-failed").text(t.stats.failed))}t.rules?e.click(function(){a.toggleClass("collapsed"),a.toggleClass("expanded")}):e.click(function(){l.selectedRuleElt&&l.selectedRuleElt.classList.remove("selected"),a.element.classList.add("selected"),l.selectedRuleElt=a.element,l.detailpanel.setRule(t)})}),t.rules&&(a.addClass("collapsible"),"webstandards"==t.id?a.addClass("expanded"):a.addClass("collapsed"),a.append("DIV","childs",function(e){l.renderRules(t.rules,e.element,n+1)}))},t.prototype.getRuleStats=function(e){var t=0,s=0,n=!1;return void 0!==e.aXeCheck&&(e=e.aXeCheck.items,n=!0),Object.keys(e).forEach(function(n){void 0!==e[n].failed&&e[n].failed&&t++,s++}),{succeed:s-t,failed:t,isAxeRulesSet:n}},t}(),a=function(){function t(e,t){this.element=t,this.plugin=e}return t.prototype.setRule=function(t){var s=this;this.element.innerHTML="";var n=e.FluentDOM.forElement(this.element);n.append("DIV","ruledetailpanel-content",function(e){e.append("DIV","item",function(e){t.type&&e.addClass(t.type),e.append("H1","title",function(e){e.createChild("SPAN","state fa "+(t.failed?"fa-close":"fa-check")),e.createChild("SPAN","text").text(t.title)}),t.description&&e.append("DIV","description",function(e){e.text(t.description)}),t.items&&t.items.length&&e.append("DIV","items",function(e){t.items.forEach(function(t){s.renderItem(t,e)})})})})},t.prototype.renderItem=function(e,t){var s=this;t.append("DIV","item",function(t){e.type&&t.addClass(e.type),e.title&&e.alert?t.createChild("SPAN","state fa "+(e.failed?"fa-close":"fa-check")).text(e.title):e.title&&t.createChild("DIV","title").text(e.title),e.message&&t.createChild("DIV","message").text(e.message),e.content&&t.createChild("DIV","content").text(e.content),e.items&&e.items.length&&t.append("DIV","items",function(t){e.items.forEach(function(e){s.renderItem(e,t)})})})},t.prototype.clear=function(e){this.setMessage(e)},t.prototype.setMessage=function(e){this.element.innerHTML='<div class="empty">'+e+"</div>"},t}()}(VORLON||(VORLON={}));