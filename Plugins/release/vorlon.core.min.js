var VORLON;!function(e){var o=function(){function o(){this._clientPlugins=new Array,this._dashboardPlugins=new Array,this._socketIOWaitCount=0,this.debug=!1,this._RetryTimeout=1002,this._isHttpsEnabled=!1}return Object.defineProperty(o.prototype,"Messenger",{get:function(){return e.Core._messenger},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"ClientPlugins",{get:function(){return e.Core._clientPlugins},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"IsHttpsEnabled",{get:function(){return e.Core._isHttpsEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"DashboardPlugins",{get:function(){return e.Core._dashboardPlugins},enumerable:!0,configurable:!0}),o.prototype.RegisterClientPlugin=function(o){e.Core._clientPlugins.push(o)},o.prototype.RegisterDashboardPlugin=function(o){e.Core._dashboardPlugins.push(o)},o.prototype.StopListening=function(){e.Core._messenger&&(e.Core._messenger.stopListening(),delete e.Core._messenger)},o.prototype.StartClientSide=function(o,t,n){function r(){d||(e.Core.Messenger.sendRealtimeMessage("",{socketid:e.Core.Messenger.socketId},e.Core._side,"clientclosed"),console.log("Disconnected from Vorlon.js instance"),d=!0),process.exit(0)}var i=this;if(void 0===o&&(o="'http://localhost:1337/'"),void 0===t&&(t=""),void 0===n&&(n=""),e.Core._side=e.RuntimeSide.Client,e.Core._sessionID=t,e.Core._listenClientId=n,"/"===o[o.length-1]&&(o=o.slice(0,-1)),o.match("^https://")&&(e.Core._isHttpsEnabled=!0),e.Tools.IsWindowAvailable&&void 0===window.io)return this._socketIOWaitCount<10?(this._socketIOWaitCount++,setTimeout(function(){console.log("Vorlon.js: waiting for socket.io to load..."),e.Core.StartClientSide(o,t,n)},1e3)):(console.log("Vorlon.js: please load socket.io before referencing vorlon.js or use includeSocketIO = true in your catalog.json file."),e.Core.ShowError("Vorlon.js: please load socket.io before referencing vorlon.js or use includeSocketIO = true in your catalog.json file.",0)),void 0;var s;e.Tools.IsWindowAvailable?(s=e.Tools.ReadCookie("vorlonJS_clientId"),s||(s=e.Tools.CreateGUID(),e.Tools.CreateCookie("vorlonJS_clientId",s,1))):s=e.Tools.CreateGUID(),e.Core._messenger&&(e.Core._messenger.stopListening(),delete e.Core._messenger),e.Core._messenger=new e.ClientMessenger(e.Core._side,o,t,s,n),e.Core.Messenger.onRealtimeMessageReceived=e.Core._Dispatch,e.Core.Messenger.onHeloReceived=e.Core._OnIdentificationReceived,e.Core.Messenger.onIdentifyReceived=e.Core._OnIdentifyReceived,e.Core.Messenger.onStopListenReceived=e.Core._OnStopListenReceived,e.Core.Messenger.onError=e.Core._OnError,e.Core.Messenger.onReload=e.Core._OnReloadClient,this.sendHelo();for(var l=0;l<e.Core._clientPlugins.length;l++){var a=e.Core._clientPlugins[l];a.startClientSide()}if(e.Tools.IsWindowAvailable)window.addEventListener("beforeunload",function(){e.Core.Messenger.sendRealtimeMessage("",{socketid:e.Core.Messenger.socketId},e.Core._side,"clientclosed")},!1);else{process.stdin.resume();var d=!1;process.on("exit",r.bind(null,{cleanup:!0})),process.on("SIGINT",r.bind(null,{exit:!0})),process.on("uncaughtException",r.bind(null,{exit:!0}))}setTimeout(function(){i.startClientDirtyCheck()},500)},o.prototype.sendHelo=function(){var o={};o=e.Tools.IsWindowAvailable?{ua:navigator.userAgent,identity:sessionStorage.vorlonClientIdentity||localStorage.vorlonClientIdentity}:{ua:"Node.js",identity:"",noWindow:!0},e.Core.Messenger.sendRealtimeMessage("",o,e.Core._side,"helo")},o.prototype.startClientDirtyCheck=function(){var o=this;if(e.Tools.IsWindowAvailable&&!document.body)return setTimeout(function(){o.startClientDirtyCheck()},200),void 0;var t=e.Tools.IsWindowAvailable&&(window.MutationObserver||window.WebKitMutationObserver);if(t){document.body.__vorlon||(document.body.__vorlon={});var n={attributes:!0,childList:!0,subtree:!0,characterData:!0};document.body.__vorlon._observerMutationObserver=new t(function(o){var t=!1,n=!1,r=[];o.forEach(function(o){if(n){for(var i=0;i<r.length;i++)clearTimeout(r[i]);n=!1}return o.target&&o.target.__vorlon&&o.target.__vorlon.ignore?(n=!0,void 0):o.previousSibling&&o.previousSibling.__vorlon&&o.previousSibling.__vorlon.ignore?(n=!0,void 0):(o.target&&!t&&o.target.__vorlon&&o.target.parentNode&&o.target.parentNode.__vorlon&&o.target.parentNode.__vorlon.internalId&&r.push(setTimeout(function(){var t=null;o&&o.target&&o.target.parentNode&&o.target.parentNode.__vorlon&&o.target.parentNode.__vorlon.internalId&&(t=o.target.parentNode.__vorlon.internalId),e.Core.Messenger.sendRealtimeMessage("ALL_PLUGINS",{type:"contentchanged",internalId:t},e.Core._side,"message")},300)),t=!0,void 0)})}),document.body.__vorlon._observerMutationObserver.observe(document.body,n)}else if(e.Tools.IsWindowAvailable){console.log("dirty check using html string");var r;document.body&&(r=document.body.innerHTML),setInterval(function(){var o=document.body.innerHTML;r!=o&&(r=o,e.Core.Messenger.sendRealtimeMessage("ALL_PLUGINS",{type:"contentchanged"},e.Core._side,"message"))},2e3)}},o.prototype.StartDashboardSide=function(o,t,n,r){if(void 0===o&&(o="'http://localhost:1337/'"),void 0===t&&(t=""),void 0===n&&(n=""),void 0===r&&(r=null),e.Core._side=e.RuntimeSide.Dashboard,e.Core._sessionID=t,e.Core._listenClientId=n,e.Core._errorNotifier=document.createElement("x-notify"),e.Core._errorNotifier.setAttribute("type","error"),e.Core._errorNotifier.setAttribute("position","top"),e.Core._errorNotifier.setAttribute("duration",5e3),e.Core._messageNotifier=document.createElement("x-notify"),e.Core._messageNotifier.setAttribute("position","top"),e.Core._messageNotifier.setAttribute("duration",4e3),document.body.appendChild(e.Core._errorNotifier),document.body.appendChild(e.Core._messageNotifier),e.Tools.IsWindowAvailable&&void 0===window.io)return this._socketIOWaitCount<10?(this._socketIOWaitCount++,setTimeout(function(){console.log("Vorlon.js: waiting for socket.io to load..."),e.Core.StartDashboardSide(o,t,n,r)},1e3)):(console.log("Vorlon.js: please load socket.io before referencing vorlon.js or use includeSocketIO = true in your catalog.json file."),e.Core.ShowError("Vorlon.js: please load socket.io before referencing vorlon.js or use includeSocketIO = true in your catalog.json file.",0)),void 0;var i=e.Tools.ReadCookie("vorlonJS_clientId");i||(i=e.Tools.CreateGUID(),e.Tools.CreateCookie("vorlonJS_clientId",i,1)),e.Core._messenger&&(e.Core._messenger.stopListening(),delete e.Core._messenger),e.Core._messenger=new e.ClientMessenger(e.Core._side,o,t,i,n),e.Core.Messenger.onRealtimeMessageReceived=e.Core._Dispatch,e.Core.Messenger.onHeloReceived=e.Core._OnIdentificationReceived,e.Core.Messenger.onIdentifyReceived=e.Core._OnIdentifyReceived,e.Core.Messenger.onStopListenReceived=e.Core._OnStopListenReceived,e.Core.Messenger.onError=e.Core._OnError;var s={ua:navigator.userAgent};e.Core.Messenger.sendRealtimeMessage("",s,e.Core._side,"helo");for(var l=0;l<e.Core._dashboardPlugins.length;l++){var a=e.Core._dashboardPlugins[l];a.startDashboardSide(r?r(a.getID()):null)}},o.prototype.GetNumClientPluginsReady=function(){var o=0;return e.Core.ClientPlugins.forEach(function(e){e.isReady()&&o++}),o},o.prototype.AllClientPluginsReady=function(){return e.Core.ClientPlugins.length===e.Core.GetNumClientPluginsReady()},o.prototype._OnStopListenReceived=function(){e.Core._listenClientId=""},o.prototype._OnIdentifyReceived=function(o){if(e.Core._side===e.RuntimeSide.Dashboard)e.Core._messageNotifier.innerHTML=o,e.Core._messageNotifier.show();else if(e.Tools.IsWindowAvailable){var t=document.createElement("div");t.className="vorlonIdentifyNumber",t.style.position="absolute",t.style.left="0",t.style.top="50%",t.style.marginTop="-150px",t.style.width="100%",t.style.height="300px",t.style.fontFamily="Arial",t.style.fontSize="300px",t.style.textAlign="center",t.style.color="white",t.style.textShadow="2px 2px 5px black",t.style.zIndex="100",t.innerHTML=o,document.body.appendChild(t),setTimeout(function(){document.body.removeChild(t)},4e3)}else console.log("Vorlon client nÂ° "+o)},o.prototype.ShowError=function(o,t){if(void 0===t&&(t=5e3),e.Core._side===e.RuntimeSide.Dashboard)e.Core._errorNotifier.innerHTML=o,e.Core._errorNotifier.setAttribute("duration",t),e.Core._errorNotifier.show();else if(e.Tools.IsWindowAvailable){var n=document.createElement("div");n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100px",n.style.backgroundColor="red",n.style.textAlign="center",n.style.fontSize="30px",n.style.paddingTop="20px",n.style.color="white",n.style.fontFamily="consolas",n.style.zIndex="1001",n.innerHTML=o,document.body.appendChild(n),t&&setTimeout(function(){document.body.removeChild(n)},t)}},o.prototype._OnError=function(o){e.Core.ShowError("Error while connecting to Vorlon server. Server may be offline.<BR>Error message: "+o.message)},o.prototype._OnIdentificationReceived=function(o){if(e.Core._listenClientId=o,e.Core._side===e.RuntimeSide.Client)for(var t=0;t<e.Core._clientPlugins.length;t++){var n=e.Core._clientPlugins[t];n.refresh()}},o.prototype._OnReloadClient=function(){e.Tools.IsWindowAvailable&&document.location.reload()},o.prototype._RetrySendingRealtimeMessage=function(o,t){setTimeout(function(){return o.isReady()?(e.Core._DispatchFromClientPluginMessage(o,t),void 0):(e.Core._RetrySendingRealtimeMessage(o,t),void 0)},e.Core._RetryTimeout)},o.prototype._Dispatch=function(o){return o.metadata?("ALL_PLUGINS"==o.metadata.pluginID?(e.Core._clientPlugins.forEach(function(t){e.Core._DispatchPluginMessage(t,o)}),e.Core._dashboardPlugins.forEach(function(t){e.Core._DispatchPluginMessage(t,o)})):(e.Core._clientPlugins.forEach(function(t){return t.getID()===o.metadata.pluginID?(e.Core._DispatchPluginMessage(t,o),void 0):void 0}),e.Core._dashboardPlugins.forEach(function(t){return t.getID()===o.metadata.pluginID?(e.Core._DispatchPluginMessage(t,o),void 0):void 0})),void 0):(console.error("invalid message "+JSON.stringify(o)),void 0)},o.prototype._DispatchPluginMessage=function(o,t){o.trace("received "+JSON.stringify(t)),t.metadata.side===e.RuntimeSide.Client?o.isReady()?e.Core._DispatchFromClientPluginMessage(o,t):e.Core._RetrySendingRealtimeMessage(o,t):e.Core._DispatchFromDashboardPluginMessage(o,t)},o.prototype._DispatchFromClientPluginMessage=function(e,o){if(o.command&&e.DashboardCommands){var t=e.DashboardCommands[o.command];if(t)return t.call(e,o.data),void 0}e.onRealtimeMessageReceivedFromClientSide(o.data)},o.prototype._DispatchFromDashboardPluginMessage=function(e,o){if(o.command&&e.ClientCommands){var t=e.ClientCommands[o.command];if(t)return t.call(e,o.data),void 0}e.onRealtimeMessageReceivedFromDashboardSide(o.data)},o}();e._Core=o,e.Core=new o}(VORLON||(VORLON={}));