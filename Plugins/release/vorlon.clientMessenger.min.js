var VORLON;!function(e){var t=function(){function t(t,n,i,s,o){var r=this;this._isConnected=!1,this._isConnected=!1,this._sessionId=i,this._clientId=s,e.Core._listenClientId=o,this._serverUrl=n;var c={path:n.replace(/h.*:\/\/[^\/]*/,"")+"/socket.io"};switch(t){case e.RuntimeSide.Client:this._socket=io.connect(n+"/client",c),this._isConnected=!0;break;case e.RuntimeSide.Dashboard:this._socket=io.connect(n+"/dashboard",c),this._isConnected=!0}if(this.isConnected){var a=io.Manager(n,c);a.on("connect_error",function(e){r.onError&&r.onError(e)}),this._socket.on("message",function(e){var t=JSON.parse(e);r.onRealtimeMessageReceived&&r.onRealtimeMessageReceived(t)}),this._socket.on("helo",function(t){e.Core._listenClientId=t,r.onHeloReceived&&r.onHeloReceived(t)}),this._socket.on("identify",function(e){r.onIdentifyReceived&&r.onIdentifyReceived(e)}),this._socket.on("stoplisten",function(){r.onStopListenReceived&&r.onStopListenReceived()}),this._socket.on("refreshclients",function(){r.onRefreshClients&&r.onRefreshClients()}),this._socket.on("addclient",function(e){r.onAddClient&&r.onAddClient(e)}),this._socket.on("removeclient",function(e){console.log("messenger refreshclients"),r.onRemoveClient&&r.onRemoveClient(e)}),this._socket.on("reload",function(t){e.Core._listenClientId=t,r.onReload&&r.onReload(t)})}}return Object.defineProperty(t.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientId",{set:function(e){this._clientId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"socketId",{get:function(){return this._socket.id},enumerable:!0,configurable:!0}),t.prototype.stopListening=function(){this._socket&&this._socket.removeAllListeners()},t.prototype.sendRealtimeMessage=function(t,n,i,s,o){void 0===s&&(s="message");var r={metadata:{pluginID:t,side:i,sessionId:this._sessionId,clientId:this._clientId,listenClientId:e.Core._listenClientId},data:n};if(o&&(r.command=o),!this.isConnected)return this.onRealtimeMessageReceived&&this.onRealtimeMessageReceived(r),void 0;if(""!==e.Core._listenClientId||"message"!==s){var c=JSON.stringify(r);this._socket.emit(s,c)}},t.prototype.sendMonitoringMessage=function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&200===n.status},n.open("POST",this._serverUrl+"api/push"),n.setRequestHeader("Content-type","application/json;charset=UTF-8");var i=JSON.stringify({_idsession:this._sessionId,id:e,message:t});n.send(i)},t.prototype.getMonitoringMessage=function(e,t,n,i){void 0===n&&(n="-20"),void 0===i&&(i="-1");var s=new XMLHttpRequest;s.onreadystatechange=function(){4===s.readyState?200===s.status?t&&t(JSON.parse(s.responseText)):t&&t(null):t&&t(null)},s.open("GET",this._serverUrl+"api/range/"+this._sessionId+"/"+e+"/"+n+"/"+i),s.send()},t}();e.ClientMessenger=t}(VORLON||(VORLON={}));