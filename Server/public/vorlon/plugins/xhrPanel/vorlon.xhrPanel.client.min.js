var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},VORLON;!function(e){var t=function(t){function o(){t.call(this,"xhrPanel"),this.hooked=!1,this.cache=[],this._id="XHRPANEL",this._ready=!1}return __extends(o,t),o.prototype.refresh=function(){this.sendStateToDashboard(),this.sendCacheToDashboard()},o.prototype.sendStateToDashboard=function(){this.sendCommandToDashboard("state",{hooked:this.hooked})},o.prototype.sendCacheToDashboard=function(){for(var e=0,t=this.cache.length;t>e;e++)this.sendCommandToDashboard("xhr",this.cache[e])},o.prototype.clearClientCache=function(){this.cache=[]},o.prototype.startClientSide=function(){this._ready=!0},o.prototype.onRealtimeMessageReceivedFromDashboardSide=function(){},o.prototype._hookPrototype=function(t,o){var s={id:e.Tools.CreateGUID(),url:null,status:null,statusText:null,method:null,responseType:null,responseHeaders:null,requestHeaders:[],readyState:0};this.cache.push(s),this._previousOpen||(this._previousOpen=o.prototype.open,this._previousSetRequestHeader=o.prototype.setRequestHeader),o.prototype.open=function(){return s.id=e.Tools.CreateGUID(),s.method=arguments[0],s.url=arguments[1],t.trace("request for "+s.url),t.sendCommandToDashboard("xhr",s),this.addEventListener("readystatechange",function(){var e=this;s.readyState=e.readyState,t.trace("STATE CHANGED "+s.readyState),4===s.readyState&&(s.responseType=e.responseType,s.status=e.status,s.statusText=e.statusText,e.getAllResponseHeaders&&(s.responseHeaders=e.getAllResponseHeaders()),t.trace("LOADED !!!")),t.sendCommandToDashboard("xhr",s)}),t._previousOpen.apply(this,arguments)},o.prototype.setRequestHeader=function(){var e={name:arguments[0],value:arguments[1]};return s.requestHeaders.push(e),this._previousSetRequestHeader.apply(this,arguments)}},o.prototype.setupXMLHttpRequestHook=function(){if(e.Tools.IsWindowAvailable)this._xhrSource=XMLHttpRequest,this._hookPrototype(this,XMLHttpRequest);else if(!this._hookAlreadyDone){this._hookAlreadyDone=!0;var t=require("path"),o=require("require-hook");o.attach(t.resolve());var s=this;o.setEvent(function(e,t){return s.hooked&&"xhr2"===t.require&&(s._xhrSource=e,s._hookPrototype(s,e)),e})}this.hooked=!0,this.sendStateToDashboard()},o.prototype.removeXMLHttpRequestHook=function(){if(this.hooked){this.trace("xhrPanel remove hook");var e=this._xhrSource;e.prototype.open=this._previousOpen,e.prototype.setRequestHeader=this._previousSetRequestHeader,this.hooked=!1,this.sendStateToDashboard()}},o.prototype._render=function(e,t,o,s){var r=document.createElement(e);return r.className=o||"",s&&(r.innerHTML=s),t.appendChild(r),r},o}(e.ClientPlugin);e.XHRPanelClient=t,t.prototype.ClientCommands={start:function(){var e=this;e.setupXMLHttpRequestHook()},stop:function(){var e=this;e.removeXMLHttpRequestHook()},getState:function(){var e=this;e.sendStateToDashboard()},clear:function(){var e=this;e.clearClientCache()}},e.Core.RegisterClientPlugin(new t)}(VORLON||(VORLON={}));