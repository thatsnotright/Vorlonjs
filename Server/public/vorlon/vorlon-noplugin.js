!function(e){"use strict";var t=function(){this.cssImportStatements=[],this.cssKeyframeStatements=[],this.cssRegex=new RegExp("([\\s\\S]*?){([\\s\\S]*?)}","gi"),this.cssMediaQueryRegex="((@media [\\s\\S]*?){([\\s\\S]*?}\\s*?)})",this.cssKeyframeRegex="((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})",this.combinedCSSRegex="((\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",this.cssCommentsRegex="(\\/\\*[\\s\\S]*?\\*\\/)",this.cssImportStatementRegex=new RegExp("@import .*?;","gi")};t.prototype.stripComments=function(e){var t=new RegExp(this.cssCommentsRegex,"gi");return e.replace(t,"")},t.prototype.parseCSS=function(e){if(void 0===e)return[];for(var t=[];;){var n=this.cssImportStatementRegex.exec(e);if(null===n)break;this.cssImportStatements.push(n[0]),t.push({selector:"@imports",type:"imports",styles:n[0]})}e=e.replace(this.cssImportStatementRegex,"");for(var o,i=new RegExp(this.cssKeyframeRegex,"gi");;){if(o=i.exec(e),null===o)break;t.push({selector:"@keyframes",type:"keyframes",styles:o[0]})}e=e.replace(i,"");for(var r=new RegExp(this.combinedCSSRegex,"gi");;){if(o=r.exec(e),null===o)break;var s="";s=void 0===o[2]?o[5].split("\r\n").join("\n").trim():o[2].split("\r\n").join("\n").trim();var a=new RegExp(this.cssCommentsRegex,"gi"),l=a.exec(s);if(null!==l&&(s=s.replace(a,"").trim()),-1!==s.indexOf("@media")){var c={selector:s,type:"media",subStyles:this.parseCSS(o[3]+"\n}")};null!==l&&(c.comments=l[0]),t.push(c)}else{var d=this.parseRules(o[6]),u={selector:s,rules:d};"@font-face"===s&&(u.type="font-face"),null!==l&&(u.comments=l[0]),t.push(u)}}return t},t.prototype.parseRules=function(e){e=e.split("\r\n").join("\n");var t=[];e=e.split(";");for(var n=0;n<e.length;n++){var o=e[n];if(o=o.trim(),-1!==o.indexOf(":")){o=o.split(":");var i=o[0].trim(),r=o.slice(1).join(":").trim();if(i.length<1||r.length<1)continue;t.push({directive:i,value:r})}else"base64,"==o.trim().substr(0,7)?t[t.length-1].value+=o.trim():o.length>0&&t.push({directive:"",value:o,defective:!0})}return t},t.prototype.findCorrespondingRule=function(e,t,n){void 0===n&&(n=!1);for(var o=!1,i=0;i<e.length&&(e[i].directive!=t||(o=e[i],n!==e[i].value));i++);return o},t.prototype.findBySelector=function(e,t,n){void 0===n&&(n=!1);for(var o=[],i=0;i<e.length;i++)n===!1?e[i].selector===t&&o.push(e[i]):-1!==e[i].selector.indexOf(t)&&o.push(e[i]);if(o.length<2)return o;var r=o[0];for(i=1;i<o.length;i++)this.intelligentCSSPush([r],o[i]);return[r]},t.prototype.deleteBySelector=function(e,t){for(var n=[],o=0;o<e.length;o++)e[o].selector!==t&&n.push(e[o]);return n},t.prototype.compressCSS=function(e){for(var t=[],n={},o=0;o<e.length;o++){var i=e[o];if(n[i.selector]!==!0){var r=this.findBySelector(e,i.selector);0!==r.length&&(t.push(r[0]),n[i.selector]=!0)}}return t},t.prototype.cssDiff=function(e,t){if(e.selector!==t.selector)return!1;if("media"===e.type||"media"===t.type)return!1;for(var n,o,i={selector:e.selector,rules:[]},r=0;r<e.rules.length;r++)n=e.rules[r],o=this.findCorrespondingRule(t.rules,n.directive,n.value),o===!1?i.rules.push(n):n.value!==o.value&&i.rules.push(n);for(var s=0;s<t.rules.length;s++)o=t.rules[s],n=this.findCorrespondingRule(e.rules,o.directive),n===!1&&(o.type="DELETED",i.rules.push(o));return 0===i.rules.length?!1:i},t.prototype.intelligentMerge=function(e,t,n){void 0===n&&(n=!1);for(var o=0;o<t.length;o++)this.intelligentCSSPush(e,t[o],n);for(o=0;o<e.length;o++){var i=e[o];"media"!==i.type&&"keyframes"!==i.type&&(i.rules=this.compactRules(i.rules))}},t.prototype.intelligentCSSPush=function(e,t,n){var o=(t.selector,!1);if(void 0===n&&(n=!1),n===!1){for(var i=0;i<e.length;i++)if(e[i].selector===t.selector){o=e[i];break}}else for(var r=e.length-1;r>-1;r--)if(e[r].selector===t.selector){o=e[r];break}if(o===!1)e.push(t);else if("media"!==t.type)for(var s=0;s<t.rules.length;s++){var a=t.rules[s],l=this.findCorrespondingRule(o.rules,a.directive);l===!1?o.rules.push(a):"DELETED"==a.type?l.type="DELETED":l.value=a.value}else o.subStyles=t.subStyles},t.prototype.compactRules=function(e){for(var t=[],n=0;n<e.length;n++)"DELETED"!==e[n].type&&t.push(e[n]);return t},t.prototype.getCSSForEditor=function(e,t){void 0===t&&(t=0);var n="";void 0===e&&(e=this.css);for(var o=0;o<e.length;o++)"imports"==e[o].type&&(n+=e[o].styles+"\n\n");for(o=0;o<e.length;o++){var i=e[o];if(void 0!==i.selector){var r="";void 0!==i.comments&&(r=i.comments+"\n"),"media"==i.type?(n+=r+i.selector+"{\n",n+=this.getCSSForEditor(i.subStyles,t+1),n+="}\n\n"):"keyframes"!==i.type&&"imports"!==i.type&&(n+=this.getSpaces(t)+r+i.selector+" {\n",n+=this.getCSSOfRules(i.rules,t+1),n+=this.getSpaces(t)+"}\n\n")}}for(o=0;o<e.length;o++)"keyframes"==e[o].type&&(n+=e[o].styles+"\n\n");return n},t.prototype.getImports=function(e){for(var t=[],n=0;n<e.length;n++)"imports"==e[n].type&&t.push(e[n].styles);return t},t.prototype.getCSSOfRules=function(e,t){for(var n="",o=0;o<e.length;o++)void 0!==e[o]&&(n+=void 0===e[o].defective?this.getSpaces(t)+e[o].directive+" : "+e[o].value+";\n":this.getSpaces(t)+e[o].value+";\n");return n||"\n"},t.prototype.getSpaces=function(e){for(var t="",n=0;4*e>n;n++)t+=" ";return t},t.prototype.applyNamespacing=function(e,t){var n=e,o="."+this.cssPreviewNamespace;void 0!==t&&(o=t),"string"==typeof e&&(n=this.parseCSS(e));for(var i=0;i<n.length;i++){var r=n[i];if(!(r.selector.indexOf("@font-face")>-1||r.selector.indexOf("keyframes")>-1||r.selector.indexOf("@import")>-1||r.selector.indexOf(".form-all")>-1||r.selector.indexOf("#stage")>-1))if("media"!==r.type){for(var s=r.selector.split(","),a=[],l=0;l<s.length;l++)-1===s[l].indexOf(".supernova")?a.push(o+" "+s[l]):a.push(s[l]);r.selector=a.join(",")}else r.subStyles=this.applyNamespacing(r.subStyles,t)}return n},t.prototype.clearNamespacing=function(e,t){void 0===t&&(t=!1);var n=e,o="."+this.cssPreviewNamespace;"string"==typeof e&&(n=this.parseCSS(e));for(var i=0;i<n.length;i++){var r=n[i];if("media"!==r.type){for(var s=r.selector.split(","),a=[],l=0;l<s.length;l++)a.push(s[l].split(o+" ").join(""));r.selector=a.join(",")}else r.subStyles=this.clearNamespacing(r.subStyles,!0)}return t===!1?this.getCSSForEditor(n):n},t.prototype.createStyleElement=function(e,t,n){if(void 0===n&&(n=!1),this.testMode===!1&&"nonamespace"!==n&&(t=this.applyNamespacing(t)),"string"!=typeof t&&(t=this.getCSSForEditor(t)),n===!0&&(t=this.getCSSForEditor(this.parseCSS(t))),this.testMode!==!1)return this.testMode("create style #"+e,t);var o=document.getElementById(e);o&&o.parentNode.removeChild(o);var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.id=e,r.type="text/css",i.appendChild(r),r.styleSheet&&!r.sheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))},e.cssjs=t}(this);var VORLON;!function(e){var t=function(){function t(){}return Object.defineProperty(t,"IsWindowAvailable",{get:function(){return"undefined"!=typeof window},enumerable:!0,configurable:!0}),t.QuerySelectorById=function(e,t){return e.querySelector?e.querySelector("#"+t):document.getElementById(t)},t.SetImmediate=function(e){window.setImmediate?setImmediate(e):setTimeout(e,0)},t.setLocalStorageValue=function(e,t){if(localStorage)try{localStorage.setItem(e,t)}catch(n){}},t.getLocalStorageValue=function(e){if(localStorage)try{return localStorage.getItem(e)}catch(t){return""}},t.Hook=function(e,t,n){var o=e[t];return e[t]=function(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];n(t),o.apply(e,t)},o},t.HookProperty=function(n,o,i){var r=(t.IsWindowAvailable?window:global)[n],s=r[o];Object.defineProperty(r,o,{get:function(){if(i){var t=e.Tools.getCallStack(1);t.property=o,i(t)}return s}})},t.getCallStack=function(e){e=e||0;try{throw new Error}catch(t){for(var n=t.stack.split("\n"),o=0,i=2+e,r=n.length;r>i;i++)if(n[i].indexOf("http://")>=0){o=i;break}var s={stack:t.stack},a=n[o],l=a.indexOf("http://")||a.indexOf("https://");if(l>0){var c=a.indexOf(")",l);0>c&&(c=a.length-1);var d=a.substr(l,c-l),u=d.indexOf(":",d.lastIndexOf("/"));s.file=d.substr(0,u),s.line=d.substr(u+1)}return s}},t.CreateCookie=function(e,t,n){var o;if(n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),o="; expires="+i.toUTCString()}else o="";document.cookie=e+"="+t+o+"; path=/"},t.ReadCookie=function(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var i=n[o];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return""},t.CreateGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})},t.RemoveEmpties=function(e){for(var t=e.length,n=t-1;n>=0;n--)e[n]||(e.splice(n,1),t--);return t},t.AddClass=function(e,n){if(e.classList){if(n.indexOf(" ")<0)e.classList.add(n);else{var o=n.split(" ");t.RemoveEmpties(o);for(var i=0,r=o.length;r>i;i++)e.classList.add(o[i])}return e}var s,a=e.className,l=a.split(" "),c=t.RemoveEmpties(l);if(n.indexOf(" ")>=0){for(o=n.split(" "),t.RemoveEmpties(o),i=0;c>i;i++){var d=o.indexOf(l[i]);d>=0&&o.splice(d,1)}o.length>0&&(s=o.join(" "))}else{var u=!1;for(i=0;c>i;i++)if(l[i]===n){u=!0;break}u||(s=n)}return s&&(e.className=c>0&&l[0].length>0?a+" "+s:s),e},t.RemoveClass=function(e,n){if(e.classList){if(0===e.classList.length)return e;var o=n.split(" ");t.RemoveEmpties(o);for(var i=0,r=o.length;r>i;i++)e.classList.remove(o[i]);return e}var s=e.className;if(n.indexOf(" ")>=0)o=n.split(" "),t.RemoveEmpties(o);else{if(s.indexOf(n)<0)return e;o=[n]}var a,l=s.split(" "),c=t.RemoveEmpties(l);for(i=c-1;i>=0;i--)o.indexOf(l[i])>=0&&(l.splice(i,1),a=!0);return a&&(e.className=l.join(" ")),e},t.ToggleClass=function(e,n,o){e.className.match(n)?(t.RemoveClass(e,n),o&&o(!1)):(t.AddClass(e,n),o&&o(!0))},t.htmlToString=function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")},t}();e.Tools=t;var n=function(){function e(e,t,n,o){this.childs=[],e&&(this.element=document.createElement(e),t&&(this.element.className=t),n&&n.appendChild(this.element),this.parent=o,o&&o.childs.push(this))}return e.forElement=function(t){var n=new e(null);return n.element=t,n},e.prototype.addClass=function(e){return this.element.classList.add(e),this},e.prototype.toggleClass=function(e){return this.element.classList.toggle(e),this},e.prototype.className=function(e){return this.element.className=e,this},e.prototype.opacity=function(e){return this.element.style.opacity=e,this},e.prototype.display=function(e){return this.element.style.display=e,this},e.prototype.hide=function(){return this.element.style.display="none",this},e.prototype.visibility=function(e){return this.element.style.visibility=e,this},e.prototype.text=function(e){return this.element.textContent=e,this},e.prototype.html=function(e){return this.element.innerHTML=e,this},e.prototype.attr=function(e,t){return this.element.setAttribute(e,t),this},e.prototype.editable=function(e){return this.element.contentEditable=e?"true":"false",this},e.prototype.style=function(e,t){return this.element.style[e]=t,this},e.prototype.appendTo=function(e){return e.appendChild(this.element),this},e.prototype.append=function(t,n,o){var i=new e(t,n,this.element,this);return o&&o(i),this},e.prototype.createChild=function(t,n){var o=new e(t,n,this.element,this);return o},e.prototype.click=function(e){return this.element.addEventListener("click",e),this},e.prototype.blur=function(e){return this.element.addEventListener("blur",e),this},e.prototype.keydown=function(e){return this.element.addEventListener("keydown",e),this},e}();e.FluentDOM=n}(VORLON||(VORLON={}));var VORLON;!function(e){!function(e){e[e.Client=0]="Client",e[e.Dashboard=1]="Dashboard",e[e.Both=2]="Both"}(e.RuntimeSide||(e.RuntimeSide={}));e.RuntimeSide;!function(e){e[e.OneOne=0]="OneOne",e[e.MulticastReceiveOnly=1]="MulticastReceiveOnly",e[e.Multicast=2]="Multicast"}(e.PluginType||(e.PluginType={}));e.PluginType}(VORLON||(VORLON={}));var VORLON;!function(e){var t=function(){function t(t){this.name=t,this._ready=!0,this._id="",this._type=e.PluginType.OneOne,this.traceLog=function(e){console.log(e)},this.traceNoop=function(){},this.loadingDirectory="vorlon/plugins",this.debug=e.Core.debug}return Object.defineProperty(t.prototype,"Type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,this.trace=e?this.traceLog:this.traceNoop},enumerable:!0,configurable:!0}),t.prototype.getID=function(){return this._id},t.prototype.isReady=function(){return this._ready},t}();e.BasePlugin=t}(VORLON||(VORLON={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},VORLON;!function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.startClientSide=function(){},n.prototype.onRealtimeMessageReceivedFromDashboardSide=function(){},n.prototype.sendToDashboard=function(t){e.Core.Messenger&&e.Core.Messenger.sendRealtimeMessage(this.getID(),t,e.RuntimeSide.Client,"message")},n.prototype.sendCommandToDashboard=function(t,n){void 0===n&&(n=null),e.Core.Messenger&&(this.trace(this.getID()+" send command to dashboard "+t),e.Core.Messenger.sendRealtimeMessage(this.getID(),n,e.RuntimeSide.Client,"message",t))},n.prototype.refresh=function(){console.error("Please override plugin.refresh()")},n.prototype._loadNewScriptAsync=function(t,n,o){function i(){var e=document.createElement("script");e.setAttribute("src",s+t),e.onload=n;var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(e,o)}var r=this,s="";s=0===this.loadingDirectory.indexOf("http")?"/"==t[0]?"":this.loadingDirectory+"/"+this.name+"/":"/"==t[0]?vorlonBaseURL:vorlonBaseURL+"/"+this.loadingDirectory+"/"+this.name+"/",e.Core.IsHttpsEnabled&&-1===s.indexOf("https://")&&(s=s.replace(/^http/,"https")),!o||document.body?i():document.addEventListener("DOMContentLoaded",function(){r._loadNewScriptAsync(t,n,o)})},n}(e.BasePlugin);e.ClientPlugin=t}(VORLON||(VORLON={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},VORLON;!function(e){var t=function(t){function n(n,o,i,r){t.call(this,n),this.htmlFragmentUrl=o,this.cssStyleSheetUrl=i instanceof Array?i:"undefined"==typeof i?[]:[i],this.JavascriptSheetUrl=r instanceof Array?r:"undefined"==typeof r?[]:[r],this.debug=e.Core.debug}return __extends(n,t),n.prototype.startDashboardSide=function(){},n.prototype.onRealtimeMessageReceivedFromClientSide=function(){},n.prototype.sendToClient=function(t){e.Core.Messenger&&e.Core.Messenger.sendRealtimeMessage(this.getID(),t,e.RuntimeSide.Dashboard,"message")},n.prototype.sendCommandToClient=function(t,n){void 0===n&&(n=null),e.Core.Messenger&&(this.trace(this.getID()+" send command to client "+t),e.Core.Messenger.sendRealtimeMessage(this.getID(),n,e.RuntimeSide.Dashboard,"message",t))},n.prototype.sendCommandToPluginClient=function(t,n,o){void 0===o&&(o=null),e.Core.Messenger&&(this.trace(this.getID()+" send command to plugin client "+n),e.Core.Messenger.sendRealtimeMessage(t,o,e.RuntimeSide.Dashboard,"protocol",n))},n.prototype.sendCommandToPluginDashboard=function(t,n,o){void 0===o&&(o=null),e.Core.Messenger&&(this.trace(this.getID()+" send command to plugin dashboard "+n),e.Core.Messenger.sendRealtimeMessage(t,o,e.RuntimeSide.Client,"protocol",n))},n.prototype._insertHtmlContentAsync=function(e,t){var n=this,o=vorlonBaseURL+"/"+this.loadingDirectory+"/"+this.name+"/",i=!1;e||(e=document.createElement("div"),document.body.appendChild(e),i=!0);var r=new XMLHttpRequest;r.open("GET",o+this.htmlFragmentUrl,!0),r.onreadystatechange=function(){if(4===r.readyState){if(200!==r.status)throw new Error("Error status: "+r.status+" - Unable to load "+o+n.htmlFragmentUrl);for(var s=document.getElementsByTagName("head")[0],a=0;a<n.cssStyleSheetUrl.length;a++){var l=document.createElement("link");l.type="text/css",l.rel="stylesheet",l.href=o+n.cssStyleSheetUrl[a],l.media="screen",s.appendChild(l)}for(var a=0;a<n.JavascriptSheetUrl.length;a++){var c=document.createElement("script");c.type="text/javascript",c.src=o+n.JavascriptSheetUrl[a],s.appendChild(c)}e.innerHTML=n._stripContent(r.responseText),$(e).find(".split").length&&$(e).find(".split").is(":visible")&&!$(e).find(".vsplitter").length&&$(e).find(".split").split({orientation:$(e).find(".split").data("orientation"),limit:$(e).find(".split").data("limit"),position:$(e).find(".split").data("position")});var d=e.children[0];i&&(d.className="alone"),t(d)}},r.send(null)},n.prototype._stripContent=function(e){var t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im;if(e){e=e.replace(t,"");var o=e.match(n);o&&(e=o[1])}return e},n}(e.BasePlugin);e.DashboardPlugin=t}(VORLON||(VORLON={}));var VORLON;!function(e){var t=function(){function t(t,n,o,i,r){var s=this;this._isConnected=!1,this._isConnected=!1,this._sessionId=o,this._clientId=i,e.Core._listenClientId=r,this._serverUrl=n;var a={path:n.replace(/h.*:\/\/[^\/]*/,"")+"/socket.io"};switch(t){case e.RuntimeSide.Client:this._socket=io.connect(n+"/client",a),this._isConnected=!0;break;case e.RuntimeSide.Dashboard:this._socket=io.connect(n+"/dashboard",a),this._isConnected=!0}if(this.isConnected){var l=io.Manager(n,a);l.on("connect_error",function(e){s.onError&&s.onError(e)}),this._socket.on("message",function(e){var t=JSON.parse(e);s.onRealtimeMessageReceived&&s.onRealtimeMessageReceived(t)}),this._socket.on("helo",function(t){e.Core._listenClientId=t,s.onHeloReceived&&s.onHeloReceived(t)}),this._socket.on("identify",function(e){s.onIdentifyReceived&&s.onIdentifyReceived(e)}),this._socket.on("stoplisten",function(){s.onStopListenReceived&&s.onStopListenReceived()}),this._socket.on("refreshclients",function(){s.onRefreshClients&&s.onRefreshClients()}),this._socket.on("addclient",function(e){s.onAddClient&&s.onAddClient(e)}),this._socket.on("removeclient",function(e){console.log("messenger refreshclients"),s.onRemoveClient&&s.onRemoveClient(e)}),this._socket.on("reload",function(t){e.Core._listenClientId=t,s.onReload&&s.onReload(t)})}}return Object.defineProperty(t.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientId",{set:function(e){this._clientId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"socketId",{get:function(){return this._socket.id},enumerable:!0,configurable:!0}),t.prototype.stopListening=function(){this._socket&&this._socket.removeAllListeners()},t.prototype.sendRealtimeMessage=function(t,n,o,i,r){void 0===i&&(i="message");var s={metadata:{pluginID:t,side:o,sessionId:this._sessionId,clientId:this._clientId,listenClientId:e.Core._listenClientId},data:n};if(r&&(s.command=r),!this.isConnected)return this.onRealtimeMessageReceived&&this.onRealtimeMessageReceived(s),void 0;if(""!==e.Core._listenClientId||"message"!==i){var a=JSON.stringify(s);this._socket.emit(i,a)}},t.prototype.sendMonitoringMessage=function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&200===n.status},n.open("POST",this._serverUrl+"api/push"),n.setRequestHeader("Content-type","application/json;charset=UTF-8");var o=JSON.stringify({_idsession:this._sessionId,id:e,message:t});n.send(o)},t.prototype.getMonitoringMessage=function(e,t,n,o){void 0===n&&(n="-20"),void 0===o&&(o="-1");var i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState?200===i.status?t&&t(JSON.parse(i.responseText)):t&&t(null):t&&t(null)},i.open("GET",this._serverUrl+"api/range/"+this._sessionId+"/"+e+"/"+n+"/"+o),i.send()},t}();e.ClientMessenger=t}(VORLON||(VORLON={}));var VORLON;!function(e){var t=function(){function t(){this._clientPlugins=new Array,this._dashboardPlugins=new Array,this._socketIOWaitCount=0,this.debug=!1,this._RetryTimeout=1002,this._isHttpsEnabled=!1}return Object.defineProperty(t.prototype,"Messenger",{get:function(){return e.Core._messenger},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ClientPlugins",{get:function(){return e.Core._clientPlugins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsHttpsEnabled",{get:function(){return e.Core._isHttpsEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DashboardPlugins",{get:function(){return e.Core._dashboardPlugins},enumerable:!0,configurable:!0}),t.prototype.RegisterClientPlugin=function(t){e.Core._clientPlugins.push(t)},t.prototype.RegisterDashboardPlugin=function(t){e.Core._dashboardPlugins.push(t)},t.prototype.StopListening=function(){e.Core._messenger&&(e.Core._messenger.stopListening(),delete e.Core._messenger)},t.prototype.StartClientSide=function(t,n,o){function i(){c||(e.Core.Messenger.sendRealtimeMessage("",{socketid:e.Core.Messenger.socketId},e.Core._side,"clientclosed"),console.log("Disconnected from Vorlon.js instance"),c=!0),process.exit(0)}var r=this;if(void 0===t&&(t="'http://localhost:1337/'"),void 0===n&&(n=""),void 0===o&&(o=""),e.Core._side=e.RuntimeSide.Client,e.Core._sessionID=n,e.Core._listenClientId=o,"/"===t[t.length-1]&&(t=t.slice(0,-1)),t.match("^https://")&&(e.Core._isHttpsEnabled=!0),e.Tools.IsWindowAvailable&&void 0===window.io)return this._socketIOWaitCount<10?(this._socketIOWaitCount++,setTimeout(function(){console.log("Vorlon.js: waiting for socket.io to load..."),e.Core.StartClientSide(t,n,o)},1e3)):(console.log("Vorlon.js: please load socket.io before referencing vorlon.js or use includeSocketIO = true in your catalog.json file."),e.Core.ShowError("Vorlon.js: please load socket.io before referencing vorlon.js or use includeSocketIO = true in your catalog.json file.",0)),void 0;var s;e.Tools.IsWindowAvailable?(s=e.Tools.ReadCookie("vorlonJS_clientId"),s||(s=e.Tools.CreateGUID(),e.Tools.CreateCookie("vorlonJS_clientId",s,1))):s=e.Tools.CreateGUID(),e.Core._messenger&&(e.Core._messenger.stopListening(),delete e.Core._messenger),e.Core._messenger=new e.ClientMessenger(e.Core._side,t,n,s,o),e.Core.Messenger.onRealtimeMessageReceived=e.Core._Dispatch,e.Core.Messenger.onHeloReceived=e.Core._OnIdentificationReceived,e.Core.Messenger.onIdentifyReceived=e.Core._OnIdentifyReceived,e.Core.Messenger.onStopListenReceived=e.Core._OnStopListenReceived,e.Core.Messenger.onError=e.Core._OnError,e.Core.Messenger.onReload=e.Core._OnReloadClient,this.sendHelo();for(var a=0;a<e.Core._clientPlugins.length;a++){var l=e.Core._clientPlugins[a];l.startClientSide()}if(e.Tools.IsWindowAvailable)window.addEventListener("beforeunload",function(){e.Core.Messenger.sendRealtimeMessage("",{socketid:e.Core.Messenger.socketId},e.Core._side,"clientclosed")},!1);else{process.stdin.resume();var c=!1;process.on("exit",i.bind(null,{cleanup:!0})),process.on("SIGINT",i.bind(null,{exit:!0})),process.on("uncaughtException",i.bind(null,{exit:!0}))}setTimeout(function(){r.startClientDirtyCheck()},500)},t.prototype.sendHelo=function(){var t={};t=e.Tools.IsWindowAvailable?{ua:navigator.userAgent,identity:sessionStorage.vorlonClientIdentity||localStorage.vorlonClientIdentity}:{ua:"Node.js",identity:"",noWindow:!0},e.Core.Messenger.sendRealtimeMessage("",t,e.Core._side,"helo")},t.prototype.startClientDirtyCheck=function(){var t=this;if(e.Tools.IsWindowAvailable&&!document.body)return setTimeout(function(){t.startClientDirtyCheck()},200),void 0;var n=e.Tools.IsWindowAvailable&&(window.MutationObserver||window.WebKitMutationObserver);if(n){document.body.__vorlon||(document.body.__vorlon={});var o={attributes:!0,childList:!0,subtree:!0,characterData:!0};document.body.__vorlon._observerMutationObserver=new n(function(t){var n=!1,o=!1,i=[];t.forEach(function(t){if(o){for(var r=0;r<i.length;r++)clearTimeout(i[r]);o=!1}return t.target&&t.target.__vorlon&&t.target.__vorlon.ignore?(o=!0,void 0):t.previousSibling&&t.previousSibling.__vorlon&&t.previousSibling.__vorlon.ignore?(o=!0,void 0):(t.target&&!n&&t.target.__vorlon&&t.target.parentNode&&t.target.parentNode.__vorlon&&t.target.parentNode.__vorlon.internalId&&i.push(setTimeout(function(){var n=null;t&&t.target&&t.target.parentNode&&t.target.parentNode.__vorlon&&t.target.parentNode.__vorlon.internalId&&(n=t.target.parentNode.__vorlon.internalId),e.Core.Messenger.sendRealtimeMessage("ALL_PLUGINS",{type:"contentchanged",internalId:n},e.Core._side,"message")},300)),n=!0,void 0)})}),document.body.__vorlon._observerMutationObserver.observe(document.body,o)}else if(e.Tools.IsWindowAvailable){console.log("dirty check using html string");var i;document.body&&(i=document.body.innerHTML),setInterval(function(){var t=document.body.innerHTML;i!=t&&(i=t,e.Core.Messenger.sendRealtimeMessage("ALL_PLUGINS",{type:"contentchanged"},e.Core._side,"message"))},2e3)}},t.prototype.StartDashboardSide=function(t,n,o,i){if(void 0===t&&(t="'http://localhost:1337/'"),void 0===n&&(n=""),void 0===o&&(o=""),void 0===i&&(i=null),e.Core._side=e.RuntimeSide.Dashboard,e.Core._sessionID=n,e.Core._listenClientId=o,e.Core._errorNotifier=document.createElement("x-notify"),e.Core._errorNotifier.setAttribute("type","error"),e.Core._errorNotifier.setAttribute("position","top"),e.Core._errorNotifier.setAttribute("duration",5e3),e.Core._messageNotifier=document.createElement("x-notify"),e.Core._messageNotifier.setAttribute("position","top"),e.Core._messageNotifier.setAttribute("duration",4e3),document.body.appendChild(e.Core._errorNotifier),document.body.appendChild(e.Core._messageNotifier),e.Tools.IsWindowAvailable&&void 0===window.io)return this._socketIOWaitCount<10?(this._socketIOWaitCount++,setTimeout(function(){console.log("Vorlon.js: waiting for socket.io to load..."),e.Core.StartDashboardSide(t,n,o,i)},1e3)):(console.log("Vorlon.js: please load socket.io before referencing vorlon.js or use includeSocketIO = true in your catalog.json file."),e.Core.ShowError("Vorlon.js: please load socket.io before referencing vorlon.js or use includeSocketIO = true in your catalog.json file.",0)),void 0;var r=e.Tools.ReadCookie("vorlonJS_clientId");r||(r=e.Tools.CreateGUID(),e.Tools.CreateCookie("vorlonJS_clientId",r,1)),e.Core._messenger&&(e.Core._messenger.stopListening(),delete e.Core._messenger),e.Core._messenger=new e.ClientMessenger(e.Core._side,t,n,r,o),e.Core.Messenger.onRealtimeMessageReceived=e.Core._Dispatch,e.Core.Messenger.onHeloReceived=e.Core._OnIdentificationReceived,e.Core.Messenger.onIdentifyReceived=e.Core._OnIdentifyReceived,e.Core.Messenger.onStopListenReceived=e.Core._OnStopListenReceived,e.Core.Messenger.onError=e.Core._OnError;var s={ua:navigator.userAgent};e.Core.Messenger.sendRealtimeMessage("",s,e.Core._side,"helo");for(var a=0;a<e.Core._dashboardPlugins.length;a++){var l=e.Core._dashboardPlugins[a];l.startDashboardSide(i?i(l.getID()):null)}},t.prototype.GetNumClientPluginsReady=function(){var t=0;return e.Core.ClientPlugins.forEach(function(e){e.isReady()&&t++}),t},t.prototype.AllClientPluginsReady=function(){return e.Core.ClientPlugins.length===e.Core.GetNumClientPluginsReady()},t.prototype._OnStopListenReceived=function(){e.Core._listenClientId=""},t.prototype._OnIdentifyReceived=function(t){if(e.Core._side===e.RuntimeSide.Dashboard)e.Core._messageNotifier.innerHTML=t,e.Core._messageNotifier.show();else if(e.Tools.IsWindowAvailable){var n=document.createElement("div");n.className="vorlonIdentifyNumber",n.style.position="absolute",n.style.left="0",n.style.top="50%",n.style.marginTop="-150px",n.style.width="100%",n.style.height="300px",n.style.fontFamily="Arial",n.style.fontSize="300px",n.style.textAlign="center",n.style.color="white",n.style.textShadow="2px 2px 5px black",n.style.zIndex="100",n.innerHTML=t,document.body.appendChild(n),setTimeout(function(){document.body.removeChild(n)},4e3)}else console.log("Vorlon client n° "+t)},t.prototype.ShowError=function(t,n){if(void 0===n&&(n=5e3),e.Core._side===e.RuntimeSide.Dashboard)e.Core._errorNotifier.innerHTML=t,e.Core._errorNotifier.setAttribute("duration",n),e.Core._errorNotifier.show();else if(e.Tools.IsWindowAvailable){var o=document.createElement("div");o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100px",o.style.backgroundColor="red",o.style.textAlign="center",o.style.fontSize="30px",o.style.paddingTop="20px",o.style.color="white",o.style.fontFamily="consolas",o.style.zIndex="1001",o.innerHTML=t,document.body.appendChild(o),n&&setTimeout(function(){document.body.removeChild(o)},n)}},t.prototype._OnError=function(t){e.Core.ShowError("Error while connecting to Vorlon server. Server may be offline.<BR>Error message: "+t.message)},t.prototype._OnIdentificationReceived=function(t){if(e.Core._listenClientId=t,e.Core._side===e.RuntimeSide.Client)for(var n=0;n<e.Core._clientPlugins.length;n++){var o=e.Core._clientPlugins[n];o.refresh()}},t.prototype._OnReloadClient=function(){e.Tools.IsWindowAvailable&&document.location.reload()},t.prototype._RetrySendingRealtimeMessage=function(t,n){setTimeout(function(){return t.isReady()?(e.Core._DispatchFromClientPluginMessage(t,n),void 0):(e.Core._RetrySendingRealtimeMessage(t,n),void 0)},e.Core._RetryTimeout)},t.prototype._Dispatch=function(t){return t.metadata?("ALL_PLUGINS"==t.metadata.pluginID?(e.Core._clientPlugins.forEach(function(n){e.Core._DispatchPluginMessage(n,t)}),e.Core._dashboardPlugins.forEach(function(n){e.Core._DispatchPluginMessage(n,t)})):(e.Core._clientPlugins.forEach(function(n){return n.getID()===t.metadata.pluginID?(e.Core._DispatchPluginMessage(n,t),void 0):void 0}),e.Core._dashboardPlugins.forEach(function(n){return n.getID()===t.metadata.pluginID?(e.Core._DispatchPluginMessage(n,t),void 0):void 0})),void 0):(console.error("invalid message "+JSON.stringify(t)),void 0)},t.prototype._DispatchPluginMessage=function(t,n){t.trace("received "+JSON.stringify(n)),n.metadata.side===e.RuntimeSide.Client?t.isReady()?e.Core._DispatchFromClientPluginMessage(t,n):e.Core._RetrySendingRealtimeMessage(t,n):e.Core._DispatchFromDashboardPluginMessage(t,n)},t.prototype._DispatchFromClientPluginMessage=function(e,t){if(t.command&&e.DashboardCommands){var n=e.DashboardCommands[t.command];if(n)return n.call(e,t.data),void 0}e.onRealtimeMessageReceivedFromClientSide(t.data)},t.prototype._DispatchFromDashboardPluginMessage=function(e,t){if(t.command&&e.ClientCommands){var n=e.ClientCommands[t.command];if(n)return n.call(e,t.data),void 0}e.onRealtimeMessageReceivedFromDashboardSide(t.data)},t}();e._Core=t,e.Core=new t}(VORLON||(VORLON={}));