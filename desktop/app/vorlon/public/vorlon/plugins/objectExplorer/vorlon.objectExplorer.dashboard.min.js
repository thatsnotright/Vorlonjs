var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},VORLON;!function(t){var e=function(t){function e(){t.call(this,"objectExplorer","control.html","control.css"),this._id="OBJEXPLORER",this._ready=!1,this._contentCallbacks={}}return __extends(e,t),e.prototype.startDashboardSide=function(t){var e=this;void 0===t&&(t=null),this._dashboardDiv=t,this._insertHtmlContentAsync(this._dashboardDiv,function(t){e._containerDiv=t,e._filterInput=e._containerDiv.querySelector("#txtFilter"),e._searchBoxInput=e._containerDiv.querySelector("#txtPropertyName"),e._searchBtn=e._containerDiv.querySelector("#btnSearchProp"),e._searchUpBtn=e._containerDiv.querySelector("#btnSearchUp"),e._treeDiv=e._containerDiv.querySelector("#treeViewObj"),e._addLoader(),e._searchBtn.onclick=function(){var t=e._searchBoxInput.value;t&&e.setCurrent(t)},e._searchUpBtn.onclick=function(){var t=e._searchBoxInput.value;if(t){var n=t.split(".");n.length>1&&(n.splice(n.length-1,1),e.setCurrent(n.join(".")))}},e._searchBoxInput.addEventListener("keydown",function(t){if(13===t.keyCode||9===t.keyCode){var n=e._searchBoxInput.value;n&&e.setCurrent(n)}}),e._filterInput.addEventListener("input",function(){e.filter()}),e._ready=!0})},e.prototype._addLoader=function(){var t=document.createElement("div");t.className="loader",t.innerHTML='<span class="fa fa-spinner fa-spin"></span> loading...',this._treeDiv.appendChild(t)},e.prototype.setCurrent=function(t){t!==this._currentPropertyPath&&(this._filterInput.value=""),this._searchBoxInput.value=t,this._currentPropertyPath=t,this.queryObjectContent(this._currentPropertyPath),this._empty(),this._treeDiv.scrollTop=0,this._addLoader()},e.prototype.filter=function(){for(var t=this._filterInput.value.toLowerCase(),e=this._treeDiv.querySelectorAll("[data-propname]"),n=0,o=e.length;o>n;n++){var i=e[n],r=i.getAttribute("data-propname");i.style.display=r&&t?r.indexOf(t)>=0?"":"none":""}},e.prototype.queryObjectContent=function(t){this.sendCommandToClient("query",{path:t})},e.prototype._sortedList=function(t){return t&&t.length?t.sort(function(t,e){var n=t.name.toLowerCase(),o=e.name.toLowerCase();return n>o?1:o>n?-1:0}):[]},e.prototype._render=function(t,e,n,o){var i=document.createElement(t);return i.className=n||"",o&&(i.innerHTML=o),e.appendChild(i),i},e.prototype._empty=function(){for(;this._treeDiv.hasChildNodes();)this._treeDiv.removeChild(this._treeDiv.lastChild)},e.prototype.onRealtimeMessageReceivedFromClientSide=function(){},e.prototype.setRoot=function(t){this._searchBoxInput.value=t.fullpath,this._currentPropertyPath=t.fullpath,this.root&&(this.root.dispose(),this.root=null),this._empty(),this.root=new n(this,this._treeDiv,t,!0)},e.prototype.setContent=function(t){this.root&&this.root.setContent(t)},e}(t.DashboardPlugin);t.ObjectExplorerDashboard=e;var n=function(){function e(e,n,o,i){void 0===i&&(i=!1);var r=new t.FluentDOM("DIV","objdescriptor",n);this.element=r.element,this.isRoot=i,this.element.__vorlon=this,this.item=o,this.plugin=e,this.childs=[],this.render(r)}return e.prototype.clear=function(){this.childs&&(this.childs.forEach(function(t){t.dispose()}),this.childs=[]),this.proto&&this.proto.dispose(),this.element.innerHTML=""},e.prototype.dispose=function(){this.clear(),this.element.__vorlon=null,this.plugin=null,this.element=null,this.item=null},e.prototype.setContent=function(t){if(!t.fullpath)return!1;if(console.log("checking "+t.fullpath+"/"+this.item.fullpath+" ("+this.childs.length+")"),t.fullpath==this.item.fullpath)return this.item=t,this.render(),!0;if(0===t.fullpath.indexOf(this.item.fullpath))for(var e=0,n=this.childs.length;n>e;e++)if(this.childs[e].obj&&this.childs[e].obj.setContent(t))return!0;return this.proto&&this.proto.setContent(t)?!0:!1},e.prototype.render=function(n){var i=this;if(n||(n=t.FluentDOM.forElement(this.element)),this.clear(),this.item){if(!this.item.contentFetched)return n.element.innerHTML="notfound"===this.item.type?'<div class="loader">Nothing found, please change your filter (or use <b>"window"</b>)...</div>':'<div class="loader"><span class="fa fa-spin fa-spinner"></span> loading content...</div>',void 0;this.item.proto&&n.append("DIV","objdescriptor-prototype expandable",function(n){var o;n.append("DIV","expand",function(t){o=t.createChild("SPAN","expand-btn").text("+"),t.createChild("SPAN","expand-label").text("[Prototype]")}).click(function(e){e.stopPropagation(),t.Tools.ToggleClass(n.element,"expanded",function(t){t?o.text("-"):o.text("+")})}),n.append("DIV","expand-content",function(t){i.proto=new e(i.plugin,t.element,i.item.proto)})}),this.item.functions&&this.item.functions.length&&n.append("DIV","objdescriptor-methods expandable",function(e){var n;e.append("DIV","expand",function(t){n=t.createChild("SPAN","expand-btn").text("+"),t.createChild("SPAN","expand-label").text("[Methods]")}).click(function(o){o.stopPropagation(),t.Tools.ToggleClass(e.element,"expanded",function(t){t?n.text("-"):n.text("+")})}),e.append("DIV","expand-content",function(t){i.item.functions.forEach(function(e){t.append("DIV","obj-method",function(t){i.isRoot&&t.attr("data-propname",(i.item.fullpath+"."+e.name).toLowerCase()),t.createChild("SPAN","method-name").text(e.name)})})})}),this.item.properties&&this.item.properties.length&&n.append("DIV","objdescriptor-properties",function(t){i.item.properties.forEach(function(e){var n=new o(i.plugin,t.element,e,i.item,i.isRoot);i.childs.push(n)})})}},e.prototype.getContent=function(){this.plugin.sendCommandToClient("queryContent",{path:this.item.fullpath})},e}(),o=(function(){function t(){}return t}(),function(){function e(e,n,o,i,r){this.isRoot=!1,this.plugin=e,this.parent=n,this.parentObj=i,this.prop=o,this.isRoot=r,this.element=new t.FluentDOM("DIV","property",n),"object"!==o.type?this.renderValueProperty():this.renderObjectProperty()}return e.prototype.dispose=function(){this.plugin=null,this.parentObj=null,this.parent=null,this.prop=null,this.obj&&(this.obj.dispose(),this.obj=null)},e.prototype.renderValueProperty=function(){this.isRoot&&this.element.attr("data-propname",(this.prop.fullpath+"."+this.prop.name).toLowerCase()),this.element.createChild("SPAN","prop-name").text(this.prop.name),this.element.createChild("SPAN","prop-value").text(this.prop.value)},e.prototype.renderObjectProperty=function(){var e,o=this;this.element.addClass("prop-object"),this.element.addClass("expandable"),this.isRoot&&this.element.attr("data-propname",(this.prop.fullpath+"."+this.prop.name).toLowerCase()),this.element.append("DIV","expand",function(t){e=t.createChild("SPAN","expand-btn").text("+"),t.createChild("SPAN","expand-label").text(o.prop.name),t.createChild("SPAN","makeroot actionicon fa fa-external-link").click(function(t){o.plugin.setCurrent(o.prop.fullpath),t.stopPropagation()})}).click(function(n){n.stopPropagation(),t.Tools.ToggleClass(o.element.element,"expanded",function(t){if(!t)return e.text("+"),void 0;e.text("-");var n=o.element.element.querySelector(".expand-content > .objdescriptor");if(n){var i=n.__vorlon;i&&setTimeout(function(){i.getContent()},0)}})}),this.element.append("DIV","expand-content",function(t){o.obj=new n(o.plugin,t.element,o.prop)})},e}());e.prototype.DashboardCommands={root:function(t){var e=this;e.setRoot(t)},content:function(t){var e=this;t&&e.setContent(t)}},t.Core.RegisterDashboardPlugin(new e)}(VORLON||(VORLON={}));