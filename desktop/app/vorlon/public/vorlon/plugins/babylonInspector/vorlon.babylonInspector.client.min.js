var VORLON;!function(T){!function(T){T[T.SPOT_MESH=0]="SPOT_MESH",T[T.UNSPOT_MESH=1]="UNSPOT_MESH",T[T.START_ANIM=2]="START_ANIM",T[T.PAUSE_ANIM=3]="PAUSE_ANIM",T[T.UNPAUSE_ANIM=4]="UNPAUSE_ANIM",T[T.STOP_ANIM=5]="STOP_ANIM",T[T.TURN_ON_LIGHT=6]="TURN_ON_LIGHT",T[T.TURN_OFF_LIGHT=7]="TURN_OFF_LIGHT",T[T.HIDE_MESH=8]="HIDE_MESH",T[T.DISPLAY_MESH=9]="DISPLAY_MESH",T[T.DISPLAY_MESH_GIZMO=10]="DISPLAY_MESH_GIZMO",T[T.HIDE_MESH_GIZMO=11]="HIDE_MESH_GIZMO"}(T.QueryTypes||(T.QueryTypes={}));T.QueryTypes;!function(T){T[T.MESH=0]="MESH",T[T.MATERIAL=1]="MATERIAL",T[T.CAMERA=2]="CAMERA",T[T.LIGHT=3]="LIGHT",T[T.SKELETTON=4]="SKELETTON"}(T.AnimTargetTypes||(T.AnimTargetTypes={}));T.AnimTargetTypes}(VORLON||(VORLON={}));
var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},VORLON;!function(e){var t=function(){function e(){this._color3ToHex=function(e){function t(e){var t=e.toString(16);return 1==t.length?"0"+t:t}return"#"+t(255*e.r)+t(255*e.g)+t(255*e.b)}}return e.prototype.generateScenesData=function(e){var t=this,i=[];return e.forEach(function(e){var a={activeCameraData:t._generateCameraData(e.activeCamera),meshesData:t._generateMeshesData(e),camerasData:t._generateCamerasData(e),lightsData:t._generateLightsData(e)};i.push(a)}),i},e.prototype._roundNumber=function(e,t){var i=Math.pow(10,t);return Math.round(i*e)/i},e.prototype._roundVector3=function(e){var t=new BABYLON.Vector3(this._roundNumber(e.x,2),this._roundNumber(e.y,2),this._roundNumber(e.z,2));return t},e.prototype._generateMaterialData=function(e){var t;return t={name:e.name,ambientColor:e.ambientColor?this._color3ToHex(e.ambientColor):void 0,diffuseColor:e.diffuseColor?this._color3ToHex(e.diffuseColor):void 0,emissiveColor:e.emissiveColor?this._color3ToHex(e.emissiveColor):void 0,specularColor:e.specularColor?this._color3ToHex(e.specularColor):void 0,diffuseTexture:e.diffuseTexture?this._generateTextureData(e.diffuseTexture):void 0}},e.prototype._generateMultiMaterialData=function(e){var t=this,i=[];e.subMaterials.forEach(function(e){i.push(t._generateMaterialData(e))});var a={name:e.name,subMaterials:i};return a},e.prototype._generateMeshesData=function(e){var t=this,i=[];return e.meshes.forEach(function(e){i.push({name:e.name,isVisible:e.isVisible,position:t._roundVector3(e.position,2),rotation:t._roundVector3(e.rotation,2),scaling:t._roundVector3(e.scaling,2),boundingBoxCenter:t._roundVector3(e.getBoundingInfo().boundingBox.center,2),material:e.material&&!e.material.subMaterials?t._generateMaterialData(e.material):void 0,multiMaterial:e.material&&e.material.subMaterials?t._generateMultiMaterialData(e.material):void 0,animations:t._generateAnimationData(e.animations)})}),i},e.prototype._generateTextureData=function(e){var t={name:e.name,url:e.url};return t},e.prototype._generateTexturesData=function(e){var t=this,i=[];return e.textures.forEach(function(e){i.push(t._generateTextureData(e))}),i},e.prototype._generateAnimationData=function(e){var t=[];return e.forEach(function(e){var i=e.getKeys();t.push({name:e.name,targetProperty:e.targetProperty,framePerSecond:e.framePerSecond,stopped:e._stopped,beginFrame:i[0].frame,endFrame:i[i.length-1].frame})}),t},e.prototype._generateCameraData=function(e){function t(e){return e instanceof BABYLON.FreeCamera?"FreeCamera":e instanceof BABYLON.ArcRotateCamera?"ArcRotateCamera":"Camera"}var i=t(e),a={name:e.name,type:i,mode:0==e.mode?"perspective":"orthographic",layerMask:e.layerMask.toString(2),position:this._roundVector3(e.position,2),animations:this._generateAnimationData(e.animations),speed:"FreeCamera"==i?e.speed:void 0,rotation:"FreeCamera"==i?this._roundVector3(e.rotation,2):void 0,alpha:"ArcRotateCamera"==i?this._roundNumber(e.alpha,2):void 0,beta:"ArcRotateCamera"==i?this._roundNumber(e.beta,2):void 0,radius:"ArcRotateCamera"==i?this._roundNumber(e.radius,2):void 0};return a},e.prototype._generateCamerasData=function(e){var t=this,i=[];return e.cameras.forEach(function(e){var a=t._generateCameraData(e);i.push(a)}),i},e.prototype._generateLightsData=function(e){function t(e){return e instanceof BABYLON.PointLight?"PointLight":e instanceof BABYLON.HemisphericLight?"HemisphericLight":e instanceof BABYLON.SpotLight?"SpotLight":e instanceof BABYLON.DirectionalLight?"DirectionalLight":"None"}var i=this,a=[];return e.lights.forEach(function(e){var n=t(e);a.push({name:e.name,position:"HemisphericLight"!=n?i._roundVector3(e.position,2):void 0,diffuse:i._color3ToHex(e.diffuse),specular:i._color3ToHex(e.specular),intensity:e.intensity,type:n,direction:"HemisphericLight"==n?i._roundVector3(e.direction,2):void 0,groundColor:"HemisphericLight"==n?i._color3ToHex(e.groundColor):void 0,isEnabled:e._isEnabled})}),a},e.prototype._generateBeforeRenderData=function(e){var t=[];return e._onBeforeRenderCallbacks.forEach(function(e){t.push({body:e.toString(2)})}),t},e.prototype._generateAfterRenderData=function(e){var t=[];return e._onAfterRenderCallbacks.forEach(function(e){t.push({body:e.toString(2)})}),t},e}(),i=function(){function e(e,t){this.client=e,this.queryType=t.queryType,this.data=t.data,this.target=null,this.targetName=null,this.sceneID=this.data.sceneID}return e.prototype.execute=function(){},e.prototype.findTarget=function(){},e}(),a=function(t){function i(e,i){t.call(this,e,i),this.targetName=this.data.meshName,this.findTarget()}return __extends(i,t),i.prototype.execute=function(){switch(this.queryType){case e.QueryTypes.SPOT_MESH:this._spotMesh(this.target);break;case e.QueryTypes.UNSPOT_MESH:this._unspotMesh(this.target)}},i.prototype.findTarget=function(){var e=this.client.scenes[this.sceneID];this.target=e.getMeshByName(this.targetName)},i.prototype._spotMesh=function(e){var t=i.spottedMeshes.indexOf(e);if(!(t>=0)){i.spottedMeshes.push(e),i.spottedMeshesMaterials.push(e.material);var a=new BABYLON.StandardMaterial("spotMaterial",e._scene);a.emissiveColor=new BABYLON.Color3(1,0,0),e.material=a}},i.prototype._unspotMesh=function(e){var t=i.spottedMeshes.indexOf(e);0>t||(e.material=i.spottedMeshesMaterials[t],i.spottedMeshes.splice(t,1),i.spottedMeshesMaterials.splice(t,1))},i.spottedMeshes=[],i.spottedMeshesMaterials=[],i}(i),n=function(t){function i(e,i){t.call(this,e,i),this.targetName=i.data.lightName,this.findTarget()}return __extends(i,t),i.prototype.execute=function(){switch(this.queryType){case e.QueryTypes.TURN_OFF_LIGHT:this._turnOffLight(this.target);break;case e.QueryTypes.TURN_ON_LIGHT:this._turnOnLight(this.target)}},i.prototype.findTarget=function(){var e=this.client.scenes[this.sceneID];this.target=e.getLightByName(this.targetName)},i.prototype._turnOnLight=function(e){e._isEnabled=!0},i.prototype._turnOffLight=function(e){e._isEnabled=!1},i}(i),r=function(t){function i(e,i){t.call(this,e,i),this.targetName=i.data.meshName,this.findTarget()}return __extends(i,t),i.prototype.execute=function(){switch(this.queryType){case e.QueryTypes.HIDE_MESH:this._hideMesh(this.target);break;case e.QueryTypes.DISPLAY_MESH:this._displayMesh(this.target)}},i.prototype.findTarget=function(){var e=this.client.scenes[this.sceneID];this.target=e.getMeshByName(this.targetName)},i.prototype._hideMesh=function(e){e.isVisible=!1},i.prototype._displayMesh=function(e){e.isVisible=!0},i}(i),s=function(t){function i(e,i){t.call(this,e,i),this.targetName=i.data.meshName,this.findTarget(),this.gizmos=[]}return __extends(i,t),i.prototype.execute=function(){switch(this.queryType){case e.QueryTypes.HIDE_MESH_GIZMO:this._hideMeshGizmos();break;case e.QueryTypes.DISPLAY_MESH_GIZMO:this._displayMeshGizmos()}},i.prototype.findTarget=function(){var e=this.client.scenes[this.sceneID];this.target=e.getMeshByName(this.targetName)},i.prototype._buildGizmos=function(){var e=this,t=this.client.scenes[this.sceneID],i=this.target.getBoundingInfo().boundingBox.directions,a=new BABYLON.Vector3(0,0,0),n=2*this.target.getBoundingInfo().boundingSphere.radius,r=[a,a.add(i[0].scaleInPlace(n))];this.gizmos[0]=BABYLON.Mesh.CreateTube(this.target.name+"_xAxis",r,.03,10,null,t),this.gizmos[0].material=new BABYLON.StandardMaterial(this.target.name+"_xAxisMat",t),this.gizmos[0].material.emissiveColor=BABYLON.Color3.Red();var s=[a,a.add(i[1].scaleInPlace(n))];this.gizmos[1]=BABYLON.Mesh.CreateTube(this.target.name+"_yAxis",s,.03,10,null,t),this.gizmos[1].material=new BABYLON.StandardMaterial(this.target.name+"_yAxisMat",t),this.gizmos[1].material.emissiveColor=BABYLON.Color3.Blue();var o=[a,a.add(i[2].scaleInPlace(n))];this.gizmos[2]=BABYLON.Mesh.CreateTube(this.target.name+"_zAxis",o,.03,10,null,t),this.gizmos[2].material=new BABYLON.StandardMaterial(this.target.name+"_zAxisMat",t),this.gizmos[2].material.emissiveColor=BABYLON.Color3.Green(),this.gizmos.forEach(function(t){t.parent=e.target}),t.lights.forEach(function(t){e.gizmos.forEach(function(e){t.excludedMeshes.push(e)})})},i.prototype._gizmosAlreadyExist=function(){var e=this.client.scenes[this.sceneID],t=e.getMeshByName(this.target.name+"_xAxis");return void 0==t?!1:!0},i.prototype._findGizmos=function(){if(this._gizmosAlreadyExist()){var e=this.client.scenes[this.sceneID];this.gizmos[0]=e.getMeshByName(this.target.name+"_xAxis"),this.gizmos[1]=e.getMeshByName(this.target.name+"_yAxis"),this.gizmos[2]=e.getMeshByName(this.target.name+"_zAxis")}},i.prototype._hideMeshGizmos=function(){this._gizmosAlreadyExist()?this._findGizmos():this._buildGizmos(),this.gizmos.forEach(function(e){e.isVisible=!1})},i.prototype._displayMeshGizmos=function(){this._gizmosAlreadyExist()?this._findGizmos():this._buildGizmos(),this.gizmos.forEach(function(e){e.isVisible=!0})},i}(i),o=function(i){function o(){i.call(this,"babylonInspector"),this._ready=!0,this.id="BABYLONINSPECTOR",this._dataGenerator=new t}return __extends(o,i),o.prototype.getID=function(){return this.id},o.prototype.refresh=function(){"undefined"!=typeof BABYLON&&(this.engine?this._sendScenesData():(this.engine=this._getBabylonEngine(),this.scenes=this.engine.scenes,this._sendScenesData()))},o.prototype.startClientSide=function(){("undefined"==typeof BABYLON||BABYLON.Engine.isSupported())&&(this.engine=this._getBabylonEngine(),this.engine&&(this.scenes=this.engine.scenes,this.refresh()))},o.prototype.onRealtimeMessageReceivedFromDashboardSide=function(t){switch(t.queryType){case e.QueryTypes.SPOT_MESH:case e.QueryTypes.UNSPOT_MESH:new a(this,t).execute();break;case e.QueryTypes.TURN_OFF_LIGHT:case e.QueryTypes.TURN_ON_LIGHT:new n(this,t).execute();break;case e.QueryTypes.DISPLAY_MESH:case e.QueryTypes.HIDE_MESH:new r(this,t).execute();break;case e.QueryTypes.DISPLAY_MESH_GIZMO:case e.QueryTypes.HIDE_MESH_GIZMO:new s(this,t).execute()}},o.prototype._findMesh=function(e,t){if("undefined"!=typeof BABYLON){var i=+t,a=this.engine.scenes[i],n=a.getMeshByName(e);return n}return null},o.prototype._sendScenesData=function(){if("undefined"!=typeof BABYLON&&this.scenes){var e=this._dataGenerator.generateScenesData(this.scenes);this.sendToDashboard({messageType:"SCENES_DATA",data:e,clientURL:window.location.href})}},o.prototype._getBabylonEngine=function(){for(var e in window)if("undefined"!=typeof BABYLON&&window[e]instanceof BABYLON.Engine)return window[e];return null},o}(e.ClientPlugin);e.BabylonInspectorClient=o,e.Core.RegisterClientPlugin(new o)}(VORLON||(VORLON={}));