var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},VORLON;!function(e){var t=function(e){function t(){e.call(this,"office"),this.objectPrototype=Object.getPrototypeOf({}),this.STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,this.ARGUMENT_NAMES=/([^\s,]+)/g,this._ready=!0,console.log("Started")}return __extends(t,e),t.prototype.getID=function(){return"OFFICE"},t.prototype.refresh=function(){var e=this;if(!document.body)return setTimeout(function(){e.refresh()},200),void 0;window.Office},t.prototype.getFunctionArgumentNames=function(e){var t=[];try{var n=e.toString().replace(this.STRIP_COMMENTS,"");t=n.slice(n.indexOf("(")+1,n.indexOf(")")).match(this.ARGUMENT_NAMES),null===t&&(t=[])}catch(i){console.error(i)}return t},t.prototype.inspectOfficeObject=function(e,t,n){var i={proto:null,fullpath:e.join("."),name:e[e.length-1],functions:[],properties:[],contentFetched:!0,type:typeof t,value:void 0};if("function"===i.type)return i;if(null===t)return i.type="null",i.value=null,i;if("object"!==i.type)return i.value=t.toString(),i;var r=Object.getOwnPropertyNames(t),o=Object.getPrototypeOf(t);o&&o!=this.objectPrototype&&(i.proto=this.inspectOfficeObject(e,o,n));for(var s=0,a=r.length;a>s;s++){var f=r[s],u="";if("__vorlon"!==f&&"$"!=f.substr(0,1)){var p=JSON.parse(JSON.stringify(e));p.push(f);try{var c=n[f];if(u=typeof c,"function"===u)i.functions.push({name:f,fullpath:p.join("."),args:this.getFunctionArgumentNames(c)});else if("undefined"===u)i.properties.push({name:f,type:u,fullpath:p.join("."),value:void 0});else if("null"===u)i.properties.push({name:f,type:u,fullpath:p.join("."),value:null});else if("object"===u){if(null===c){var l={name:f,type:"null",fullpath:p.join("."),contentFetched:!0};i.properties.push(l)}else if(-1==p.indexOf(f.toString())||p.indexOf(f.toString())==p.length-1){var h=this.inspectOfficeObject(p,c,c);h.properties.length>0&&i.properties.push(h)}}else void 0!==c&&null!==c&&i.properties.push({name:f,fullpath:p.join("."),type:u,value:c.toString()})}catch(y){this.trace("error reading property "+f+" of type "+u),this.trace(y),i.properties.push({name:f,type:u,fullpath:p.join("."),val:"oups, Vorlon has an error reading this "+u+" property..."})}}}return i},t.prototype.startClientSide=function(){},t.prototype.query=function(e){var t=["window",e];if(null===window[e]||void 0===window[e])return this.sendToDashboard({type:"empty",name:e,value:void 0});var n=this.inspectOfficeObject(t,window[e],window[e]);return window.Office&&void 0!==window.Office&&null!==window.Office?this.sendToDashboard({type:"object",name:e,value:n}):this.sendToDashboard({type:"error",name:e,value:"Office not defined"})},t.prototype.stringify=function(e){var t=[];return JSON.stringify(e,function(e,n){if("object"==typeof n&&null!==n){if(-1!==t.indexOf(n))return;t.push(n)}return n})},t.prototype.getAsyncResult=function(e){return function(t){return t.status==window.Office.AsyncResultStatus.Failed?e.reject(t.error):e.resolve(t.value)}},t.prototype.executeFunction=function(e){var t=$.Deferred();try{var n=this.getFunctionOrProperty(e.name);(null===n||void 0===n||null===n.fn||void 0===n.fn)&&t.reject("this function is not allowed in this mode.");var i=e.args;(void 0===i||null===i)&&(i=[]),"string"==typeof i&&(i=[i]);for(var r=[],o=0;o<i.length;o++){var s=i[o];if("string"==typeof s)r.push(s);else if($.isPlainObject(s)&&s.type)switch(s.type){case"Datetime":r.push(new Date(Date.parse(s.value)));break;case"Json":r.push(JSON.parse(s.value));break;default:r.push(s.value)}else $.isPlainObject(s)&&r.push(s)}if(e.hasAsyncResult)r.push(this.getAsyncResult(t)),n.fn.apply(n.obj,r);else{var a=n.fn.apply(n.obj,r);t.resolve(a)}}catch(f){t.reject(f)}return t.promise()},t.prototype.getOfficeType=function(){return window.Office&&window.Office.context?window.Office.context.mailbox?{officeType:"Outlook"}:window.Office.context.requirements&&window.Office.context.requirements._setMap&&window.Office.context.requirements._setMap._sets?{officeType:window.Office.context.requirements._setMap._sets}:{officeType:"Office"}:void 0},t.prototype.getFunctionOrProperty=function(e){if(void 0===e||null===e||""===e.trim())return void 0;var t=e.split(".");if(0===t.length)return void 0;"window"==t[0]&&(t=t.slice(1,t.length));for(var n={obj:void 0,fn:void 0},i=window;t.length>0;){var r=t[0];2==t.length&&(n.obj=i[r]),t=t.slice(1,t.length),i=i[r]}return n.fn=i,n},t.prototype.onRealtimeMessageReceivedFromDashboardSide=function(e){var t=this;switch(e.type){case"query":this.query(e.name);break;case"officetype":var n=this.getOfficeType();this.sendToDashboard({type:"officetype",value:n});break;case"property":var i=this.getFunctionOrProperty(e.name);this.sendToDashboard({type:"property",name:e.name,value:i});break;case"function":this.executeFunction(e).then(function(n){var i=t.stringify(n);t.sendToDashboard({type:"function",name:e.name,value:i})}).fail(function(n){var i=t.stringify(n);t.sendToDashboard({type:"error",name:e.name,value:i})})}},t}(e.ClientPlugin);e.OfficeClient=t,e.Core.RegisterClientPlugin(new t)}(VORLON||(VORLON={}));